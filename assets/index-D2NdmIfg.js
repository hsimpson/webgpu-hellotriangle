(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))L(O);new MutationObserver(O=>{for(const v of O)if(v.type==="childList")for(const H of v.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&L(H)}).observe(document,{childList:!0,subtree:!0});function I(O){const v={};return O.integrity&&(v.integrity=O.integrity),O.referrerPolicy&&(v.referrerPolicy=O.referrerPolicy),O.crossOrigin==="use-credentials"?v.credentials="include":O.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function L(O){if(O.ep)return;O.ep=!0;const v=I(O);fetch(O.href,v)}})();function rt(d,x){return class extends d{constructor(...I){super(...I),x(this)}}}const it=rt(Array,d=>d.fill(0));let F=1e-6;function ut(d){function x(l=0,M=0){const p=new d(2);return l!==void 0&&(p[0]=l,M!==void 0&&(p[1]=M)),p}const I=x;function L(l,M,p){const n=p??new d(2);return n[0]=l,n[1]=M,n}function O(l,M){const p=M??new d(2);return p[0]=Math.ceil(l[0]),p[1]=Math.ceil(l[1]),p}function v(l,M){const p=M??new d(2);return p[0]=Math.floor(l[0]),p[1]=Math.floor(l[1]),p}function H(l,M){const p=M??new d(2);return p[0]=Math.round(l[0]),p[1]=Math.round(l[1]),p}function wn(l,M=0,p=1,n){const u=n??new d(2);return u[0]=Math.min(p,Math.max(M,l[0])),u[1]=Math.min(p,Math.max(M,l[1])),u}function K(l,M,p){const n=p??new d(2);return n[0]=l[0]+M[0],n[1]=l[1]+M[1],n}function Dn(l,M,p,n){const u=n??new d(2);return u[0]=l[0]+M[0]*p,u[1]=l[1]+M[1]*p,u}function J(l,M){const p=l[0],n=l[1],u=M[0],s=M[1],o=Math.sqrt(p*p+n*n),e=Math.sqrt(u*u+s*s),r=o*e,h=r&&Sn(l,M)/r;return Math.acos(h)}function Q(l,M,p){const n=p??new d(2);return n[0]=l[0]-M[0],n[1]=l[1]-M[1],n}const yn=Q;function hn(l,M){return Math.abs(l[0]-M[0])<F&&Math.abs(l[1]-M[1])<F}function xn(l,M){return l[0]===M[0]&&l[1]===M[1]}function ln(l,M,p,n){const u=n??new d(2);return u[0]=l[0]+p*(M[0]-l[0]),u[1]=l[1]+p*(M[1]-l[1]),u}function En(l,M,p,n){const u=n??new d(2);return u[0]=l[0]+p[0]*(M[0]-l[0]),u[1]=l[1]+p[1]*(M[1]-l[1]),u}function Tn(l,M,p){const n=p??new d(2);return n[0]=Math.max(l[0],M[0]),n[1]=Math.max(l[1],M[1]),n}function dn(l,M,p){const n=p??new d(2);return n[0]=Math.min(l[0],M[0]),n[1]=Math.min(l[1],M[1]),n}function k(l,M,p){const n=p??new d(2);return n[0]=l[0]*M,n[1]=l[1]*M,n}const Vn=k;function gn(l,M,p){const n=p??new d(2);return n[0]=l[0]/M,n[1]=l[1]/M,n}function zn(l,M){const p=M??new d(2);return p[0]=1/l[0],p[1]=1/l[1],p}const In=zn;function An(l,M,p){const n=p??new d(3),u=l[0]*M[1]-l[1]*M[0];return n[0]=0,n[1]=0,n[2]=u,n}function Sn(l,M){return l[0]*M[0]+l[1]*M[1]}function _(l){const M=l[0],p=l[1];return Math.sqrt(M*M+p*p)}const Un=_;function cn(l){const M=l[0],p=l[1];return M*M+p*p}const vn=cn;function m(l,M){const p=l[0]-M[0],n=l[1]-M[1];return Math.sqrt(p*p+n*n)}const G=m;function $(l,M){const p=l[0]-M[0],n=l[1]-M[1];return p*p+n*n}const U=$;function on(l,M){const p=M??new d(2),n=l[0],u=l[1],s=Math.sqrt(n*n+u*u);return s>1e-5?(p[0]=n/s,p[1]=u/s):(p[0]=0,p[1]=0),p}function Ln(l,M){const p=M??new d(2);return p[0]=-l[0],p[1]=-l[1],p}function X(l,M){const p=M??new d(2);return p[0]=l[0],p[1]=l[1],p}const Gn=X;function Mn(l,M,p){const n=p??new d(2);return n[0]=l[0]*M[0],n[1]=l[1]*M[1],n}const $n=Mn;function pn(l,M,p){const n=p??new d(2);return n[0]=l[0]/M[0],n[1]=l[1]/M[1],n}const Fn=pn;function On(l=1,M){const p=M??new d(2),n=Math.random()*2*Math.PI;return p[0]=Math.cos(n)*l,p[1]=Math.sin(n)*l,p}function D(l){const M=l??new d(2);return M[0]=0,M[1]=0,M}function A(l,M,p){const n=p??new d(2),u=l[0],s=l[1];return n[0]=u*M[0]+s*M[4]+M[12],n[1]=u*M[1]+s*M[5]+M[13],n}function w(l,M,p){const n=p??new d(2),u=l[0],s=l[1];return n[0]=M[0]*u+M[4]*s+M[8],n[1]=M[1]*u+M[5]*s+M[9],n}function t(l,M,p,n){const u=n??new d(2),s=l[0]-M[0],o=l[1]-M[1],e=Math.sin(p),r=Math.cos(p);return u[0]=s*r-o*e+M[0],u[1]=s*e+o*r+M[1],u}function i(l,M,p){const n=p??new d(2);return on(l,n),k(n,M,n)}function c(l,M,p){const n=p??new d(2);return _(l)>M?i(l,M,n):X(l,n)}function a(l,M,p){const n=p??new d(2);return ln(l,M,.5,n)}return{create:x,fromValues:I,set:L,ceil:O,floor:v,round:H,clamp:wn,add:K,addScaled:Dn,angle:J,subtract:Q,sub:yn,equalsApproximately:hn,equals:xn,lerp:ln,lerpV:En,max:Tn,min:dn,mulScalar:k,scale:Vn,divScalar:gn,inverse:zn,invert:In,cross:An,dot:Sn,length:_,len:Un,lengthSq:cn,lenSq:vn,distance:m,dist:G,distanceSq:$,distSq:U,normalize:on,negate:Ln,copy:X,clone:Gn,multiply:Mn,mul:$n,divide:pn,div:Fn,random:On,zero:D,transformMat4:A,transformMat3:w,rotate:t,setLength:i,truncate:c,midpoint:a}}const Cn=new Map;function ot(d){let x=Cn.get(d);return x||(x=ut(d),Cn.set(d,x)),x}function at(d){function x(e,r,h){const f=new d(3);return e!==void 0&&(f[0]=e,r!==void 0&&(f[1]=r,h!==void 0&&(f[2]=h))),f}const I=x;function L(e,r,h,f){const y=f??new d(3);return y[0]=e,y[1]=r,y[2]=h,y}function O(e,r){const h=r??new d(3);return h[0]=Math.ceil(e[0]),h[1]=Math.ceil(e[1]),h[2]=Math.ceil(e[2]),h}function v(e,r){const h=r??new d(3);return h[0]=Math.floor(e[0]),h[1]=Math.floor(e[1]),h[2]=Math.floor(e[2]),h}function H(e,r){const h=r??new d(3);return h[0]=Math.round(e[0]),h[1]=Math.round(e[1]),h[2]=Math.round(e[2]),h}function wn(e,r=0,h=1,f){const y=f??new d(3);return y[0]=Math.min(h,Math.max(r,e[0])),y[1]=Math.min(h,Math.max(r,e[1])),y[2]=Math.min(h,Math.max(r,e[2])),y}function K(e,r,h){const f=h??new d(3);return f[0]=e[0]+r[0],f[1]=e[1]+r[1],f[2]=e[2]+r[2],f}function Dn(e,r,h,f){const y=f??new d(3);return y[0]=e[0]+r[0]*h,y[1]=e[1]+r[1]*h,y[2]=e[2]+r[2]*h,y}function J(e,r){const h=e[0],f=e[1],y=e[2],g=r[0],z=r[1],q=r[2],S=Math.sqrt(h*h+f*f+y*y),P=Math.sqrt(g*g+z*z+q*q),B=S*P,V=B&&Sn(e,r)/B;return Math.acos(V)}function Q(e,r,h){const f=h??new d(3);return f[0]=e[0]-r[0],f[1]=e[1]-r[1],f[2]=e[2]-r[2],f}const yn=Q;function hn(e,r){return Math.abs(e[0]-r[0])<F&&Math.abs(e[1]-r[1])<F&&Math.abs(e[2]-r[2])<F}function xn(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function ln(e,r,h,f){const y=f??new d(3);return y[0]=e[0]+h*(r[0]-e[0]),y[1]=e[1]+h*(r[1]-e[1]),y[2]=e[2]+h*(r[2]-e[2]),y}function En(e,r,h,f){const y=f??new d(3);return y[0]=e[0]+h[0]*(r[0]-e[0]),y[1]=e[1]+h[1]*(r[1]-e[1]),y[2]=e[2]+h[2]*(r[2]-e[2]),y}function Tn(e,r,h){const f=h??new d(3);return f[0]=Math.max(e[0],r[0]),f[1]=Math.max(e[1],r[1]),f[2]=Math.max(e[2],r[2]),f}function dn(e,r,h){const f=h??new d(3);return f[0]=Math.min(e[0],r[0]),f[1]=Math.min(e[1],r[1]),f[2]=Math.min(e[2],r[2]),f}function k(e,r,h){const f=h??new d(3);return f[0]=e[0]*r,f[1]=e[1]*r,f[2]=e[2]*r,f}const Vn=k;function gn(e,r,h){const f=h??new d(3);return f[0]=e[0]/r,f[1]=e[1]/r,f[2]=e[2]/r,f}function zn(e,r){const h=r??new d(3);return h[0]=1/e[0],h[1]=1/e[1],h[2]=1/e[2],h}const In=zn;function An(e,r,h){const f=h??new d(3),y=e[2]*r[0]-e[0]*r[2],g=e[0]*r[1]-e[1]*r[0];return f[0]=e[1]*r[2]-e[2]*r[1],f[1]=y,f[2]=g,f}function Sn(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function _(e){const r=e[0],h=e[1],f=e[2];return Math.sqrt(r*r+h*h+f*f)}const Un=_;function cn(e){const r=e[0],h=e[1],f=e[2];return r*r+h*h+f*f}const vn=cn;function m(e,r){const h=e[0]-r[0],f=e[1]-r[1],y=e[2]-r[2];return Math.sqrt(h*h+f*f+y*y)}const G=m;function $(e,r){const h=e[0]-r[0],f=e[1]-r[1],y=e[2]-r[2];return h*h+f*f+y*y}const U=$;function on(e,r){const h=r??new d(3),f=e[0],y=e[1],g=e[2],z=Math.sqrt(f*f+y*y+g*g);return z>1e-5?(h[0]=f/z,h[1]=y/z,h[2]=g/z):(h[0]=0,h[1]=0,h[2]=0),h}function Ln(e,r){const h=r??new d(3);return h[0]=-e[0],h[1]=-e[1],h[2]=-e[2],h}function X(e,r){const h=r??new d(3);return h[0]=e[0],h[1]=e[1],h[2]=e[2],h}const Gn=X;function Mn(e,r,h){const f=h??new d(3);return f[0]=e[0]*r[0],f[1]=e[1]*r[1],f[2]=e[2]*r[2],f}const $n=Mn;function pn(e,r,h){const f=h??new d(3);return f[0]=e[0]/r[0],f[1]=e[1]/r[1],f[2]=e[2]/r[2],f}const Fn=pn;function On(e=1,r){const h=r??new d(3),f=Math.random()*2*Math.PI,y=Math.random()*2-1,g=Math.sqrt(1-y*y)*e;return h[0]=Math.cos(f)*g,h[1]=Math.sin(f)*g,h[2]=y*e,h}function D(e){const r=e??new d(3);return r[0]=0,r[1]=0,r[2]=0,r}function A(e,r,h){const f=h??new d(3),y=e[0],g=e[1],z=e[2],q=r[3]*y+r[7]*g+r[11]*z+r[15]||1;return f[0]=(r[0]*y+r[4]*g+r[8]*z+r[12])/q,f[1]=(r[1]*y+r[5]*g+r[9]*z+r[13])/q,f[2]=(r[2]*y+r[6]*g+r[10]*z+r[14])/q,f}function w(e,r,h){const f=h??new d(3),y=e[0],g=e[1],z=e[2];return f[0]=y*r[0*4+0]+g*r[1*4+0]+z*r[2*4+0],f[1]=y*r[0*4+1]+g*r[1*4+1]+z*r[2*4+1],f[2]=y*r[0*4+2]+g*r[1*4+2]+z*r[2*4+2],f}function t(e,r,h){const f=h??new d(3),y=e[0],g=e[1],z=e[2];return f[0]=y*r[0]+g*r[4]+z*r[8],f[1]=y*r[1]+g*r[5]+z*r[9],f[2]=y*r[2]+g*r[6]+z*r[10],f}function i(e,r,h){const f=h??new d(3),y=r[0],g=r[1],z=r[2],q=r[3]*2,S=e[0],P=e[1],B=e[2],V=g*B-z*P,E=z*S-y*B,T=y*P-g*S;return f[0]=S+V*q+(g*T-z*E)*2,f[1]=P+E*q+(z*V-y*T)*2,f[2]=B+T*q+(y*E-g*V)*2,f}function c(e,r){const h=r??new d(3);return h[0]=e[12],h[1]=e[13],h[2]=e[14],h}function a(e,r,h){const f=h??new d(3),y=r*4;return f[0]=e[y+0],f[1]=e[y+1],f[2]=e[y+2],f}function l(e,r){const h=r??new d(3),f=e[0],y=e[1],g=e[2],z=e[4],q=e[5],S=e[6],P=e[8],B=e[9],V=e[10];return h[0]=Math.sqrt(f*f+y*y+g*g),h[1]=Math.sqrt(z*z+q*q+S*S),h[2]=Math.sqrt(P*P+B*B+V*V),h}function M(e,r,h,f){const y=f??new d(3),g=[],z=[];return g[0]=e[0]-r[0],g[1]=e[1]-r[1],g[2]=e[2]-r[2],z[0]=g[0],z[1]=g[1]*Math.cos(h)-g[2]*Math.sin(h),z[2]=g[1]*Math.sin(h)+g[2]*Math.cos(h),y[0]=z[0]+r[0],y[1]=z[1]+r[1],y[2]=z[2]+r[2],y}function p(e,r,h,f){const y=f??new d(3),g=[],z=[];return g[0]=e[0]-r[0],g[1]=e[1]-r[1],g[2]=e[2]-r[2],z[0]=g[2]*Math.sin(h)+g[0]*Math.cos(h),z[1]=g[1],z[2]=g[2]*Math.cos(h)-g[0]*Math.sin(h),y[0]=z[0]+r[0],y[1]=z[1]+r[1],y[2]=z[2]+r[2],y}function n(e,r,h,f){const y=f??new d(3),g=[],z=[];return g[0]=e[0]-r[0],g[1]=e[1]-r[1],g[2]=e[2]-r[2],z[0]=g[0]*Math.cos(h)-g[1]*Math.sin(h),z[1]=g[0]*Math.sin(h)+g[1]*Math.cos(h),z[2]=g[2],y[0]=z[0]+r[0],y[1]=z[1]+r[1],y[2]=z[2]+r[2],y}function u(e,r,h){const f=h??new d(3);return on(e,f),k(f,r,f)}function s(e,r,h){const f=h??new d(3);return _(e)>r?u(e,r,f):X(e,f)}function o(e,r,h){const f=h??new d(3);return ln(e,r,.5,f)}return{create:x,fromValues:I,set:L,ceil:O,floor:v,round:H,clamp:wn,add:K,addScaled:Dn,angle:J,subtract:Q,sub:yn,equalsApproximately:hn,equals:xn,lerp:ln,lerpV:En,max:Tn,min:dn,mulScalar:k,scale:Vn,divScalar:gn,inverse:zn,invert:In,cross:An,dot:Sn,length:_,len:Un,lengthSq:cn,lenSq:vn,distance:m,dist:G,distanceSq:$,distSq:U,normalize:on,negate:Ln,copy:X,clone:Gn,multiply:Mn,mul:$n,divide:pn,div:Fn,random:On,zero:D,transformMat4:A,transformMat4Upper3x3:w,transformMat3:t,transformQuat:i,getTranslation:c,getAxis:a,getScaling:l,rotateX:M,rotateY:p,rotateZ:n,setLength:u,truncate:s,midpoint:o}}const nt=new Map;function _n(d){let x=nt.get(d);return x||(x=at(d),nt.set(d,x)),x}function ft(d){const x=ot(d),I=_n(d);function L(t,i,c,a,l,M,p,n,u){const s=new d(12);return s[3]=0,s[7]=0,s[11]=0,t!==void 0&&(s[0]=t,i!==void 0&&(s[1]=i,c!==void 0&&(s[2]=c,a!==void 0&&(s[4]=a,l!==void 0&&(s[5]=l,M!==void 0&&(s[6]=M,p!==void 0&&(s[8]=p,n!==void 0&&(s[9]=n,u!==void 0&&(s[10]=u))))))))),s}function O(t,i,c,a,l,M,p,n,u,s){const o=s??new d(12);return o[0]=t,o[1]=i,o[2]=c,o[3]=0,o[4]=a,o[5]=l,o[6]=M,o[7]=0,o[8]=p,o[9]=n,o[10]=u,o[11]=0,o}function v(t,i){const c=i??new d(12);return c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=0,c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=0,c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=0,c}function H(t,i){const c=i??new d(12),a=t[0],l=t[1],M=t[2],p=t[3],n=a+a,u=l+l,s=M+M,o=a*n,e=l*n,r=l*u,h=M*n,f=M*u,y=M*s,g=p*n,z=p*u,q=p*s;return c[0]=1-r-y,c[1]=e+q,c[2]=h-z,c[3]=0,c[4]=e-q,c[5]=1-o-y,c[6]=f+g,c[7]=0,c[8]=h+z,c[9]=f-g,c[10]=1-o-r,c[11]=0,c}function wn(t,i){const c=i??new d(12);return c[0]=-t[0],c[1]=-t[1],c[2]=-t[2],c[4]=-t[4],c[5]=-t[5],c[6]=-t[6],c[8]=-t[8],c[9]=-t[9],c[10]=-t[10],c}function K(t,i,c){const a=c??new d(12);return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a[4]=t[4]*i,a[5]=t[5]*i,a[6]=t[6]*i,a[8]=t[8]*i,a[9]=t[9]*i,a[10]=t[10]*i,a}const Dn=K;function J(t,i,c){const a=c??new d(12);return a[0]=t[0]+i[0],a[1]=t[1]+i[1],a[2]=t[2]+i[2],a[4]=t[4]+i[4],a[5]=t[5]+i[5],a[6]=t[6]+i[6],a[8]=t[8]+i[8],a[9]=t[9]+i[9],a[10]=t[10]+i[10],a}function Q(t,i){const c=i??new d(12);return c[0]=t[0],c[1]=t[1],c[2]=t[2],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[8]=t[8],c[9]=t[9],c[10]=t[10],c}const yn=Q;function hn(t,i){return Math.abs(t[0]-i[0])<F&&Math.abs(t[1]-i[1])<F&&Math.abs(t[2]-i[2])<F&&Math.abs(t[4]-i[4])<F&&Math.abs(t[5]-i[5])<F&&Math.abs(t[6]-i[6])<F&&Math.abs(t[8]-i[8])<F&&Math.abs(t[9]-i[9])<F&&Math.abs(t[10]-i[10])<F}function xn(t,i){return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]}function ln(t){const i=t??new d(12);return i[0]=1,i[1]=0,i[2]=0,i[4]=0,i[5]=1,i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function En(t,i){const c=i??new d(12);if(c===t){let r;return r=t[1],t[1]=t[4],t[4]=r,r=t[2],t[2]=t[8],t[8]=r,r=t[6],t[6]=t[9],t[9]=r,c}const a=t[0*4+0],l=t[0*4+1],M=t[0*4+2],p=t[1*4+0],n=t[1*4+1],u=t[1*4+2],s=t[2*4+0],o=t[2*4+1],e=t[2*4+2];return c[0]=a,c[1]=p,c[2]=s,c[4]=l,c[5]=n,c[6]=o,c[8]=M,c[9]=u,c[10]=e,c}function Tn(t,i){const c=i??new d(12),a=t[0*4+0],l=t[0*4+1],M=t[0*4+2],p=t[1*4+0],n=t[1*4+1],u=t[1*4+2],s=t[2*4+0],o=t[2*4+1],e=t[2*4+2],r=e*n-u*o,h=-e*p+u*s,f=o*p-n*s,y=1/(a*r+l*h+M*f);return c[0]=r*y,c[1]=(-e*l+M*o)*y,c[2]=(u*l-M*n)*y,c[4]=h*y,c[5]=(e*a-M*s)*y,c[6]=(-u*a+M*p)*y,c[8]=f*y,c[9]=(-o*a+l*s)*y,c[10]=(n*a-l*p)*y,c}function dn(t){const i=t[0],c=t[0*4+1],a=t[0*4+2],l=t[1*4+0],M=t[1*4+1],p=t[1*4+2],n=t[2*4+0],u=t[2*4+1],s=t[2*4+2];return i*(M*s-u*p)-l*(c*s-u*a)+n*(c*p-M*a)}const k=Tn;function Vn(t,i,c){const a=c??new d(12),l=t[0],M=t[1],p=t[2],n=t[4],u=t[5],s=t[6],o=t[8],e=t[9],r=t[10],h=i[0],f=i[1],y=i[2],g=i[4],z=i[5],q=i[6],S=i[8],P=i[9],B=i[10];return a[0]=l*h+n*f+o*y,a[1]=M*h+u*f+e*y,a[2]=p*h+s*f+r*y,a[4]=l*g+n*z+o*q,a[5]=M*g+u*z+e*q,a[6]=p*g+s*z+r*q,a[8]=l*S+n*P+o*B,a[9]=M*S+u*P+e*B,a[10]=p*S+s*P+r*B,a}const gn=Vn;function zn(t,i,c){const a=c??ln();return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[4]=t[4],a[5]=t[5],a[6]=t[6]),a[8]=i[0],a[9]=i[1],a[10]=1,a}function In(t,i){const c=i??x.create();return c[0]=t[8],c[1]=t[9],c}function An(t,i,c){const a=c??x.create(),l=i*4;return a[0]=t[l+0],a[1]=t[l+1],a}function Sn(t,i,c,a){const l=a===t?t:Q(t,a),M=c*4;return l[M+0]=i[0],l[M+1]=i[1],l}function _(t,i){const c=i??x.create(),a=t[0],l=t[1],M=t[4],p=t[5];return c[0]=Math.sqrt(a*a+l*l),c[1]=Math.sqrt(M*M+p*p),c}function Un(t,i){const c=i??I.create(),a=t[0],l=t[1],M=t[2],p=t[4],n=t[5],u=t[6],s=t[8],o=t[9],e=t[10];return c[0]=Math.sqrt(a*a+l*l+M*M),c[1]=Math.sqrt(p*p+n*n+u*u),c[2]=Math.sqrt(s*s+o*o+e*e),c}function cn(t,i){const c=i??new d(12);return c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=1,c[6]=0,c[8]=t[0],c[9]=t[1],c[10]=1,c}function vn(t,i,c){const a=c??new d(12),l=i[0],M=i[1],p=t[0],n=t[1],u=t[2],s=t[1*4+0],o=t[1*4+1],e=t[1*4+2],r=t[2*4+0],h=t[2*4+1],f=t[2*4+2];return t!==a&&(a[0]=p,a[1]=n,a[2]=u,a[4]=s,a[5]=o,a[6]=e),a[8]=p*l+s*M+r,a[9]=n*l+o*M+h,a[10]=u*l+e*M+f,a}function m(t,i){const c=i??new d(12),a=Math.cos(t),l=Math.sin(t);return c[0]=a,c[1]=l,c[2]=0,c[4]=-l,c[5]=a,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function G(t,i,c){const a=c??new d(12),l=t[0*4+0],M=t[0*4+1],p=t[0*4+2],n=t[1*4+0],u=t[1*4+1],s=t[1*4+2],o=Math.cos(i),e=Math.sin(i);return a[0]=o*l+e*n,a[1]=o*M+e*u,a[2]=o*p+e*s,a[4]=o*n-e*l,a[5]=o*u-e*M,a[6]=o*s-e*p,t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10]),a}function $(t,i){const c=i??new d(12),a=Math.cos(t),l=Math.sin(t);return c[0]=1,c[1]=0,c[2]=0,c[4]=0,c[5]=a,c[6]=l,c[8]=0,c[9]=-l,c[10]=a,c}function U(t,i,c){const a=c??new d(12),l=t[4],M=t[5],p=t[6],n=t[8],u=t[9],s=t[10],o=Math.cos(i),e=Math.sin(i);return a[4]=o*l+e*n,a[5]=o*M+e*u,a[6]=o*p+e*s,a[8]=o*n-e*l,a[9]=o*u-e*M,a[10]=o*s-e*p,t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2]),a}function on(t,i){const c=i??new d(12),a=Math.cos(t),l=Math.sin(t);return c[0]=a,c[1]=0,c[2]=-l,c[4]=0,c[5]=1,c[6]=0,c[8]=l,c[9]=0,c[10]=a,c}function Ln(t,i,c){const a=c??new d(12),l=t[0*4+0],M=t[0*4+1],p=t[0*4+2],n=t[2*4+0],u=t[2*4+1],s=t[2*4+2],o=Math.cos(i),e=Math.sin(i);return a[0]=o*l-e*n,a[1]=o*M-e*u,a[2]=o*p-e*s,a[8]=o*n+e*l,a[9]=o*u+e*M,a[10]=o*s+e*p,t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6]),a}const X=m,Gn=G;function Mn(t,i){const c=i??new d(12);return c[0]=t[0],c[1]=0,c[2]=0,c[4]=0,c[5]=t[1],c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function $n(t,i,c){const a=c??new d(12),l=i[0],M=i[1];return a[0]=l*t[0*4+0],a[1]=l*t[0*4+1],a[2]=l*t[0*4+2],a[4]=M*t[1*4+0],a[5]=M*t[1*4+1],a[6]=M*t[1*4+2],t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10]),a}function pn(t,i){const c=i??new d(12);return c[0]=t[0],c[1]=0,c[2]=0,c[4]=0,c[5]=t[1],c[6]=0,c[8]=0,c[9]=0,c[10]=t[2],c}function Fn(t,i,c){const a=c??new d(12),l=i[0],M=i[1],p=i[2];return a[0]=l*t[0*4+0],a[1]=l*t[0*4+1],a[2]=l*t[0*4+2],a[4]=M*t[1*4+0],a[5]=M*t[1*4+1],a[6]=M*t[1*4+2],a[8]=p*t[2*4+0],a[9]=p*t[2*4+1],a[10]=p*t[2*4+2],a}function On(t,i){const c=i??new d(12);return c[0]=t,c[1]=0,c[2]=0,c[4]=0,c[5]=t,c[6]=0,c[8]=0,c[9]=0,c[10]=1,c}function D(t,i,c){const a=c??new d(12);return a[0]=i*t[0*4+0],a[1]=i*t[0*4+1],a[2]=i*t[0*4+2],a[4]=i*t[1*4+0],a[5]=i*t[1*4+1],a[6]=i*t[1*4+2],t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10]),a}function A(t,i){const c=i??new d(12);return c[0]=t,c[1]=0,c[2]=0,c[4]=0,c[5]=t,c[6]=0,c[8]=0,c[9]=0,c[10]=t,c}function w(t,i,c){const a=c??new d(12);return a[0]=i*t[0*4+0],a[1]=i*t[0*4+1],a[2]=i*t[0*4+2],a[4]=i*t[1*4+0],a[5]=i*t[1*4+1],a[6]=i*t[1*4+2],a[8]=i*t[2*4+0],a[9]=i*t[2*4+1],a[10]=i*t[2*4+2],a}return{add:J,clone:yn,copy:Q,create:L,determinant:dn,equals:xn,equalsApproximately:hn,fromMat4:v,fromQuat:H,get3DScaling:Un,getAxis:An,getScaling:_,getTranslation:In,identity:ln,inverse:Tn,invert:k,mul:gn,mulScalar:Dn,multiply:Vn,multiplyScalar:K,negate:wn,rotate:G,rotateX:U,rotateY:Ln,rotateZ:Gn,rotation:m,rotationX:$,rotationY:on,rotationZ:X,scale:$n,scale3D:Fn,scaling:Mn,scaling3D:pn,set:O,setAxis:Sn,setTranslation:zn,translate:vn,translation:cn,transpose:En,uniformScale:D,uniformScale3D:w,uniformScaling:On,uniformScaling3D:A}}const tt=new Map;function wt(d){let x=tt.get(d);return x||(x=ft(d),tt.set(d,x)),x}function ht(d){const x=_n(d);function I(n,u,s,o,e,r,h,f,y,g,z,q,S,P,B,V){const E=new d(16);return n!==void 0&&(E[0]=n,u!==void 0&&(E[1]=u,s!==void 0&&(E[2]=s,o!==void 0&&(E[3]=o,e!==void 0&&(E[4]=e,r!==void 0&&(E[5]=r,h!==void 0&&(E[6]=h,f!==void 0&&(E[7]=f,y!==void 0&&(E[8]=y,g!==void 0&&(E[9]=g,z!==void 0&&(E[10]=z,q!==void 0&&(E[11]=q,S!==void 0&&(E[12]=S,P!==void 0&&(E[13]=P,B!==void 0&&(E[14]=B,V!==void 0&&(E[15]=V)))))))))))))))),E}function L(n,u,s,o,e,r,h,f,y,g,z,q,S,P,B,V,E){const T=E??new d(16);return T[0]=n,T[1]=u,T[2]=s,T[3]=o,T[4]=e,T[5]=r,T[6]=h,T[7]=f,T[8]=y,T[9]=g,T[10]=z,T[11]=q,T[12]=S,T[13]=P,T[14]=B,T[15]=V,T}function O(n,u){const s=u??new d(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=0,s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=0,s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function v(n,u){const s=u??new d(16),o=n[0],e=n[1],r=n[2],h=n[3],f=o+o,y=e+e,g=r+r,z=o*f,q=e*f,S=e*y,P=r*f,B=r*y,V=r*g,E=h*f,T=h*y,N=h*g;return s[0]=1-S-V,s[1]=q+N,s[2]=P-T,s[3]=0,s[4]=q-N,s[5]=1-z-V,s[6]=B+E,s[7]=0,s[8]=P+T,s[9]=B-E,s[10]=1-z-S,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function H(n,u){const s=u??new d(16);return s[0]=-n[0],s[1]=-n[1],s[2]=-n[2],s[3]=-n[3],s[4]=-n[4],s[5]=-n[5],s[6]=-n[6],s[7]=-n[7],s[8]=-n[8],s[9]=-n[9],s[10]=-n[10],s[11]=-n[11],s[12]=-n[12],s[13]=-n[13],s[14]=-n[14],s[15]=-n[15],s}function wn(n,u,s){const o=s??new d(16);return o[0]=n[0]+u[0],o[1]=n[1]+u[1],o[2]=n[2]+u[2],o[3]=n[3]+u[3],o[4]=n[4]+u[4],o[5]=n[5]+u[5],o[6]=n[6]+u[6],o[7]=n[7]+u[7],o[8]=n[8]+u[8],o[9]=n[9]+u[9],o[10]=n[10]+u[10],o[11]=n[11]+u[11],o[12]=n[12]+u[12],o[13]=n[13]+u[13],o[14]=n[14]+u[14],o[15]=n[15]+u[15],o}function K(n,u,s){const o=s??new d(16);return o[0]=n[0]*u,o[1]=n[1]*u,o[2]=n[2]*u,o[3]=n[3]*u,o[4]=n[4]*u,o[5]=n[5]*u,o[6]=n[6]*u,o[7]=n[7]*u,o[8]=n[8]*u,o[9]=n[9]*u,o[10]=n[10]*u,o[11]=n[11]*u,o[12]=n[12]*u,o[13]=n[13]*u,o[14]=n[14]*u,o[15]=n[15]*u,o}const Dn=K;function J(n,u){const s=u??new d(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s}const Q=J;function yn(n,u){return Math.abs(n[0]-u[0])<F&&Math.abs(n[1]-u[1])<F&&Math.abs(n[2]-u[2])<F&&Math.abs(n[3]-u[3])<F&&Math.abs(n[4]-u[4])<F&&Math.abs(n[5]-u[5])<F&&Math.abs(n[6]-u[6])<F&&Math.abs(n[7]-u[7])<F&&Math.abs(n[8]-u[8])<F&&Math.abs(n[9]-u[9])<F&&Math.abs(n[10]-u[10])<F&&Math.abs(n[11]-u[11])<F&&Math.abs(n[12]-u[12])<F&&Math.abs(n[13]-u[13])<F&&Math.abs(n[14]-u[14])<F&&Math.abs(n[15]-u[15])<F}function hn(n,u){return n[0]===u[0]&&n[1]===u[1]&&n[2]===u[2]&&n[3]===u[3]&&n[4]===u[4]&&n[5]===u[5]&&n[6]===u[6]&&n[7]===u[7]&&n[8]===u[8]&&n[9]===u[9]&&n[10]===u[10]&&n[11]===u[11]&&n[12]===u[12]&&n[13]===u[13]&&n[14]===u[14]&&n[15]===u[15]}function xn(n){const u=n??new d(16);return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function ln(n,u){const s=u??new d(16);if(s===n){let R;return R=n[1],n[1]=n[4],n[4]=R,R=n[2],n[2]=n[8],n[8]=R,R=n[3],n[3]=n[12],n[12]=R,R=n[6],n[6]=n[9],n[9]=R,R=n[7],n[7]=n[13],n[13]=R,R=n[11],n[11]=n[14],n[14]=R,s}const o=n[0*4+0],e=n[0*4+1],r=n[0*4+2],h=n[0*4+3],f=n[1*4+0],y=n[1*4+1],g=n[1*4+2],z=n[1*4+3],q=n[2*4+0],S=n[2*4+1],P=n[2*4+2],B=n[2*4+3],V=n[3*4+0],E=n[3*4+1],T=n[3*4+2],N=n[3*4+3];return s[0]=o,s[1]=f,s[2]=q,s[3]=V,s[4]=e,s[5]=y,s[6]=S,s[7]=E,s[8]=r,s[9]=g,s[10]=P,s[11]=T,s[12]=h,s[13]=z,s[14]=B,s[15]=N,s}function En(n,u){const s=u??new d(16),o=n[0*4+0],e=n[0*4+1],r=n[0*4+2],h=n[0*4+3],f=n[1*4+0],y=n[1*4+1],g=n[1*4+2],z=n[1*4+3],q=n[2*4+0],S=n[2*4+1],P=n[2*4+2],B=n[2*4+3],V=n[3*4+0],E=n[3*4+1],T=n[3*4+2],N=n[3*4+3],R=P*N,Z=T*B,Y=g*N,W=T*z,j=g*B,b=P*z,C=r*N,nn=T*h,tn=r*B,en=P*h,rn=r*z,un=g*h,an=q*E,fn=V*S,Pn=f*E,qn=V*y,Bn=f*S,Nn=q*y,Xn=o*E,Zn=V*e,Yn=o*S,Wn=q*e,Hn=o*y,Qn=f*e,Jn=R*y+W*S+j*E-(Z*y+Y*S+b*E),kn=Z*e+C*S+en*E-(R*e+nn*S+tn*E),mn=Y*e+nn*y+rn*E-(W*e+C*y+un*E),bn=b*e+tn*y+un*S-(j*e+en*y+rn*S),sn=1/(o*Jn+f*kn+q*mn+V*bn);return s[0]=sn*Jn,s[1]=sn*kn,s[2]=sn*mn,s[3]=sn*bn,s[4]=sn*(Z*f+Y*q+b*V-(R*f+W*q+j*V)),s[5]=sn*(R*o+nn*q+tn*V-(Z*o+C*q+en*V)),s[6]=sn*(W*o+C*f+un*V-(Y*o+nn*f+rn*V)),s[7]=sn*(j*o+en*f+rn*q-(b*o+tn*f+un*q)),s[8]=sn*(an*z+qn*B+Bn*N-(fn*z+Pn*B+Nn*N)),s[9]=sn*(fn*h+Xn*B+Wn*N-(an*h+Zn*B+Yn*N)),s[10]=sn*(Pn*h+Zn*z+Hn*N-(qn*h+Xn*z+Qn*N)),s[11]=sn*(Nn*h+Yn*z+Qn*B-(Bn*h+Wn*z+Hn*B)),s[12]=sn*(Pn*P+Nn*T+fn*g-(Bn*T+an*g+qn*P)),s[13]=sn*(Yn*T+an*r+Zn*P-(Xn*P+Wn*T+fn*r)),s[14]=sn*(Xn*g+Qn*T+qn*r-(Hn*T+Pn*r+Zn*g)),s[15]=sn*(Hn*P+Bn*r+Wn*g-(Yn*g+Qn*P+Nn*r)),s}function Tn(n){const u=n[0],s=n[0*4+1],o=n[0*4+2],e=n[0*4+3],r=n[1*4+0],h=n[1*4+1],f=n[1*4+2],y=n[1*4+3],g=n[2*4+0],z=n[2*4+1],q=n[2*4+2],S=n[2*4+3],P=n[3*4+0],B=n[3*4+1],V=n[3*4+2],E=n[3*4+3],T=q*E,N=V*S,R=f*E,Z=V*y,Y=f*S,W=q*y,j=o*E,b=V*e,C=o*S,nn=q*e,tn=o*y,en=f*e,rn=T*h+Z*z+Y*B-(N*h+R*z+W*B),un=N*s+j*z+nn*B-(T*s+b*z+C*B),an=R*s+b*h+tn*B-(Z*s+j*h+en*B),fn=W*s+C*h+en*z-(Y*s+nn*h+tn*z);return u*rn+r*un+g*an+P*fn}const dn=En;function k(n,u,s){const o=s??new d(16),e=n[0],r=n[1],h=n[2],f=n[3],y=n[4],g=n[5],z=n[6],q=n[7],S=n[8],P=n[9],B=n[10],V=n[11],E=n[12],T=n[13],N=n[14],R=n[15],Z=u[0],Y=u[1],W=u[2],j=u[3],b=u[4],C=u[5],nn=u[6],tn=u[7],en=u[8],rn=u[9],un=u[10],an=u[11],fn=u[12],Pn=u[13],qn=u[14],Bn=u[15];return o[0]=e*Z+y*Y+S*W+E*j,o[1]=r*Z+g*Y+P*W+T*j,o[2]=h*Z+z*Y+B*W+N*j,o[3]=f*Z+q*Y+V*W+R*j,o[4]=e*b+y*C+S*nn+E*tn,o[5]=r*b+g*C+P*nn+T*tn,o[6]=h*b+z*C+B*nn+N*tn,o[7]=f*b+q*C+V*nn+R*tn,o[8]=e*en+y*rn+S*un+E*an,o[9]=r*en+g*rn+P*un+T*an,o[10]=h*en+z*rn+B*un+N*an,o[11]=f*en+q*rn+V*un+R*an,o[12]=e*fn+y*Pn+S*qn+E*Bn,o[13]=r*fn+g*Pn+P*qn+T*Bn,o[14]=h*fn+z*Pn+B*qn+N*Bn,o[15]=f*fn+q*Pn+V*qn+R*Bn,o}const Vn=k;function gn(n,u,s){const o=s??xn();return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11]),o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o}function zn(n,u){const s=u??x.create();return s[0]=n[12],s[1]=n[13],s[2]=n[14],s}function In(n,u,s){const o=s??x.create(),e=u*4;return o[0]=n[e+0],o[1]=n[e+1],o[2]=n[e+2],o}function An(n,u,s,o){const e=o===n?o:J(n,o),r=s*4;return e[r+0]=u[0],e[r+1]=u[1],e[r+2]=u[2],e}function Sn(n,u){const s=u??x.create(),o=n[0],e=n[1],r=n[2],h=n[4],f=n[5],y=n[6],g=n[8],z=n[9],q=n[10];return s[0]=Math.sqrt(o*o+e*e+r*r),s[1]=Math.sqrt(h*h+f*f+y*y),s[2]=Math.sqrt(g*g+z*z+q*q),s}function _(n,u,s,o,e){const r=e??new d(16),h=Math.tan(Math.PI*.5-.5*n);if(r[0]=h/u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,Number.isFinite(o)){const f=1/(s-o);r[10]=o*f,r[14]=o*s*f}else r[10]=-1,r[14]=-s;return r}function Un(n,u,s,o=1/0,e){const r=e??new d(16),h=1/Math.tan(n*.5);if(r[0]=h/u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,o===1/0)r[10]=0,r[14]=s;else{const f=1/(o-s);r[10]=s*f,r[14]=o*s*f}return r}function cn(n,u,s,o,e,r,h){const f=h??new d(16);return f[0]=2/(u-n),f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2/(o-s),f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1/(e-r),f[11]=0,f[12]=(u+n)/(n-u),f[13]=(o+s)/(s-o),f[14]=e/(e-r),f[15]=1,f}function vn(n,u,s,o,e,r,h){const f=h??new d(16),y=u-n,g=o-s,z=e-r;return f[0]=2*e/y,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2*e/g,f[6]=0,f[7]=0,f[8]=(n+u)/y,f[9]=(o+s)/g,f[10]=r/z,f[11]=-1,f[12]=0,f[13]=0,f[14]=e*r/z,f[15]=0,f}function m(n,u,s,o,e,r=1/0,h){const f=h??new d(16),y=u-n,g=o-s;if(f[0]=2*e/y,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=2*e/g,f[6]=0,f[7]=0,f[8]=(n+u)/y,f[9]=(o+s)/g,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,r===1/0)f[10]=0,f[14]=e;else{const z=1/(r-e);f[10]=e*z,f[14]=r*e*z}return f}const G=x.create(),$=x.create(),U=x.create();function on(n,u,s,o){const e=o??new d(16);return x.normalize(x.subtract(u,n,U),U),x.normalize(x.cross(s,U,G),G),x.normalize(x.cross(U,G,$),$),e[0]=G[0],e[1]=G[1],e[2]=G[2],e[3]=0,e[4]=$[0],e[5]=$[1],e[6]=$[2],e[7]=0,e[8]=U[0],e[9]=U[1],e[10]=U[2],e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Ln(n,u,s,o){const e=o??new d(16);return x.normalize(x.subtract(n,u,U),U),x.normalize(x.cross(s,U,G),G),x.normalize(x.cross(U,G,$),$),e[0]=G[0],e[1]=G[1],e[2]=G[2],e[3]=0,e[4]=$[0],e[5]=$[1],e[6]=$[2],e[7]=0,e[8]=U[0],e[9]=U[1],e[10]=U[2],e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function X(n,u,s,o){const e=o??new d(16);return x.normalize(x.subtract(n,u,U),U),x.normalize(x.cross(s,U,G),G),x.normalize(x.cross(U,G,$),$),e[0]=G[0],e[1]=$[0],e[2]=U[0],e[3]=0,e[4]=G[1],e[5]=$[1],e[6]=U[1],e[7]=0,e[8]=G[2],e[9]=$[2],e[10]=U[2],e[11]=0,e[12]=-(G[0]*n[0]+G[1]*n[1]+G[2]*n[2]),e[13]=-($[0]*n[0]+$[1]*n[1]+$[2]*n[2]),e[14]=-(U[0]*n[0]+U[1]*n[1]+U[2]*n[2]),e[15]=1,e}function Gn(n,u){const s=u??new d(16);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=n[0],s[13]=n[1],s[14]=n[2],s[15]=1,s}function Mn(n,u,s){const o=s??new d(16),e=u[0],r=u[1],h=u[2],f=n[0],y=n[1],g=n[2],z=n[3],q=n[1*4+0],S=n[1*4+1],P=n[1*4+2],B=n[1*4+3],V=n[2*4+0],E=n[2*4+1],T=n[2*4+2],N=n[2*4+3],R=n[3*4+0],Z=n[3*4+1],Y=n[3*4+2],W=n[3*4+3];return n!==o&&(o[0]=f,o[1]=y,o[2]=g,o[3]=z,o[4]=q,o[5]=S,o[6]=P,o[7]=B,o[8]=V,o[9]=E,o[10]=T,o[11]=N),o[12]=f*e+q*r+V*h+R,o[13]=y*e+S*r+E*h+Z,o[14]=g*e+P*r+T*h+Y,o[15]=z*e+B*r+N*h+W,o}function $n(n,u){const s=u??new d(16),o=Math.cos(n),e=Math.sin(n);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=o,s[6]=e,s[7]=0,s[8]=0,s[9]=-e,s[10]=o,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function pn(n,u,s){const o=s??new d(16),e=n[4],r=n[5],h=n[6],f=n[7],y=n[8],g=n[9],z=n[10],q=n[11],S=Math.cos(u),P=Math.sin(u);return o[4]=S*e+P*y,o[5]=S*r+P*g,o[6]=S*h+P*z,o[7]=S*f+P*q,o[8]=S*y-P*e,o[9]=S*g-P*r,o[10]=S*z-P*h,o[11]=S*q-P*f,n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function Fn(n,u){const s=u??new d(16),o=Math.cos(n),e=Math.sin(n);return s[0]=o,s[1]=0,s[2]=-e,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=e,s[9]=0,s[10]=o,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function On(n,u,s){const o=s??new d(16),e=n[0*4+0],r=n[0*4+1],h=n[0*4+2],f=n[0*4+3],y=n[2*4+0],g=n[2*4+1],z=n[2*4+2],q=n[2*4+3],S=Math.cos(u),P=Math.sin(u);return o[0]=S*e-P*y,o[1]=S*r-P*g,o[2]=S*h-P*z,o[3]=S*f-P*q,o[8]=S*y+P*e,o[9]=S*g+P*r,o[10]=S*z+P*h,o[11]=S*q+P*f,n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function D(n,u){const s=u??new d(16),o=Math.cos(n),e=Math.sin(n);return s[0]=o,s[1]=e,s[2]=0,s[3]=0,s[4]=-e,s[5]=o,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function A(n,u,s){const o=s??new d(16),e=n[0*4+0],r=n[0*4+1],h=n[0*4+2],f=n[0*4+3],y=n[1*4+0],g=n[1*4+1],z=n[1*4+2],q=n[1*4+3],S=Math.cos(u),P=Math.sin(u);return o[0]=S*e+P*y,o[1]=S*r+P*g,o[2]=S*h+P*z,o[3]=S*f+P*q,o[4]=S*y-P*e,o[5]=S*g-P*r,o[6]=S*z-P*h,o[7]=S*q-P*f,n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function w(n,u,s){const o=s??new d(16);let e=n[0],r=n[1],h=n[2];const f=Math.sqrt(e*e+r*r+h*h);e/=f,r/=f,h/=f;const y=e*e,g=r*r,z=h*h,q=Math.cos(u),S=Math.sin(u),P=1-q;return o[0]=y+(1-y)*q,o[1]=e*r*P+h*S,o[2]=e*h*P-r*S,o[3]=0,o[4]=e*r*P-h*S,o[5]=g+(1-g)*q,o[6]=r*h*P+e*S,o[7]=0,o[8]=e*h*P+r*S,o[9]=r*h*P-e*S,o[10]=z+(1-z)*q,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}const t=w;function i(n,u,s,o){const e=o??new d(16);let r=u[0],h=u[1],f=u[2];const y=Math.sqrt(r*r+h*h+f*f);r/=y,h/=y,f/=y;const g=r*r,z=h*h,q=f*f,S=Math.cos(s),P=Math.sin(s),B=1-S,V=g+(1-g)*S,E=r*h*B+f*P,T=r*f*B-h*P,N=r*h*B-f*P,R=z+(1-z)*S,Z=h*f*B+r*P,Y=r*f*B+h*P,W=h*f*B-r*P,j=q+(1-q)*S,b=n[0],C=n[1],nn=n[2],tn=n[3],en=n[4],rn=n[5],un=n[6],an=n[7],fn=n[8],Pn=n[9],qn=n[10],Bn=n[11];return e[0]=V*b+E*en+T*fn,e[1]=V*C+E*rn+T*Pn,e[2]=V*nn+E*un+T*qn,e[3]=V*tn+E*an+T*Bn,e[4]=N*b+R*en+Z*fn,e[5]=N*C+R*rn+Z*Pn,e[6]=N*nn+R*un+Z*qn,e[7]=N*tn+R*an+Z*Bn,e[8]=Y*b+W*en+j*fn,e[9]=Y*C+W*rn+j*Pn,e[10]=Y*nn+W*un+j*qn,e[11]=Y*tn+W*an+j*Bn,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e}const c=i;function a(n,u){const s=u??new d(16);return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function l(n,u,s){const o=s??new d(16),e=u[0],r=u[1],h=u[2];return o[0]=e*n[0*4+0],o[1]=e*n[0*4+1],o[2]=e*n[0*4+2],o[3]=e*n[0*4+3],o[4]=r*n[1*4+0],o[5]=r*n[1*4+1],o[6]=r*n[1*4+2],o[7]=r*n[1*4+3],o[8]=h*n[2*4+0],o[9]=h*n[2*4+1],o[10]=h*n[2*4+2],o[11]=h*n[2*4+3],n!==o&&(o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function M(n,u){const s=u??new d(16);return s[0]=n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function p(n,u,s){const o=s??new d(16);return o[0]=u*n[0*4+0],o[1]=u*n[0*4+1],o[2]=u*n[0*4+2],o[3]=u*n[0*4+3],o[4]=u*n[1*4+0],o[5]=u*n[1*4+1],o[6]=u*n[1*4+2],o[7]=u*n[1*4+3],o[8]=u*n[2*4+0],o[9]=u*n[2*4+1],o[10]=u*n[2*4+2],o[11]=u*n[2*4+3],n!==o&&(o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}return{add:wn,aim:on,axisRotate:i,axisRotation:w,cameraAim:Ln,clone:Q,copy:J,create:I,determinant:Tn,equals:hn,equalsApproximately:yn,fromMat3:O,fromQuat:v,frustum:vn,frustumReverseZ:m,getAxis:In,getScaling:Sn,getTranslation:zn,identity:xn,inverse:En,invert:dn,lookAt:X,mul:Vn,mulScalar:Dn,multiply:k,multiplyScalar:K,negate:H,ortho:cn,perspective:_,perspectiveReverseZ:Un,rotate:c,rotateX:pn,rotateY:On,rotateZ:A,rotation:t,rotationX:$n,rotationY:Fn,rotationZ:D,scale:l,scaling:a,set:L,setAxis:An,setTranslation:gn,translate:Mn,translation:Gn,transpose:ln,uniformScale:p,uniformScaling:M}}const et=new Map;function lt(d){let x=et.get(d);return x||(x=ht(d),et.set(d,x)),x}function dt(d){const x=_n(d);function I(D,A,w,t){const i=new d(4);return D!==void 0&&(i[0]=D,A!==void 0&&(i[1]=A,w!==void 0&&(i[2]=w,t!==void 0&&(i[3]=t)))),i}const L=I;function O(D,A,w,t,i){const c=i??new d(4);return c[0]=D,c[1]=A,c[2]=w,c[3]=t,c}function v(D,A,w){const t=w??new d(4),i=A*.5,c=Math.sin(i);return t[0]=c*D[0],t[1]=c*D[1],t[2]=c*D[2],t[3]=Math.cos(i),t}function H(D,A){const w=A??x.create(3),t=Math.acos(D[3])*2,i=Math.sin(t*.5);return i>F?(w[0]=D[0]/i,w[1]=D[1]/i,w[2]=D[2]/i):(w[0]=1,w[1]=0,w[2]=0),{angle:t,axis:w}}function wn(D,A){const w=_(D,A);return Math.acos(2*w*w-1)}function K(D,A,w){const t=w??new d(4),i=D[0],c=D[1],a=D[2],l=D[3],M=A[0],p=A[1],n=A[2],u=A[3];return t[0]=i*u+l*M+c*n-a*p,t[1]=c*u+l*p+a*M-i*n,t[2]=a*u+l*n+i*p-c*M,t[3]=l*u-i*M-c*p-a*n,t}const Dn=K;function J(D,A,w){const t=w??new d(4),i=A*.5,c=D[0],a=D[1],l=D[2],M=D[3],p=Math.sin(i),n=Math.cos(i);return t[0]=c*n+M*p,t[1]=a*n+l*p,t[2]=l*n-a*p,t[3]=M*n-c*p,t}function Q(D,A,w){const t=w??new d(4),i=A*.5,c=D[0],a=D[1],l=D[2],M=D[3],p=Math.sin(i),n=Math.cos(i);return t[0]=c*n-l*p,t[1]=a*n+M*p,t[2]=l*n+c*p,t[3]=M*n-a*p,t}function yn(D,A,w){const t=w??new d(4),i=A*.5,c=D[0],a=D[1],l=D[2],M=D[3],p=Math.sin(i),n=Math.cos(i);return t[0]=c*n+a*p,t[1]=a*n-c*p,t[2]=l*n+M*p,t[3]=M*n-l*p,t}function hn(D,A,w,t){const i=t??new d(4),c=D[0],a=D[1],l=D[2],M=D[3];let p=A[0],n=A[1],u=A[2],s=A[3],o=c*p+a*n+l*u+M*s;o<0&&(o=-o,p=-p,n=-n,u=-u,s=-s);let e,r;if(1-o>F){const h=Math.acos(o),f=Math.sin(h);e=Math.sin((1-w)*h)/f,r=Math.sin(w*h)/f}else e=1-w,r=w;return i[0]=e*c+r*p,i[1]=e*a+r*n,i[2]=e*l+r*u,i[3]=e*M+r*s,i}function xn(D,A){const w=A??new d(4),t=D[0],i=D[1],c=D[2],a=D[3],l=t*t+i*i+c*c+a*a,M=l?1/l:0;return w[0]=-t*M,w[1]=-i*M,w[2]=-c*M,w[3]=a*M,w}function ln(D,A){const w=A??new d(4);return w[0]=-D[0],w[1]=-D[1],w[2]=-D[2],w[3]=D[3],w}function En(D,A){const w=A??new d(4),t=D[0]+D[5]+D[10];if(t>0){const i=Math.sqrt(t+1);w[3]=.5*i;const c=.5/i;w[0]=(D[6]-D[9])*c,w[1]=(D[8]-D[2])*c,w[2]=(D[1]-D[4])*c}else{let i=0;D[5]>D[0]&&(i=1),D[10]>D[i*4+i]&&(i=2);const c=(i+1)%3,a=(i+2)%3,l=Math.sqrt(D[i*4+i]-D[c*4+c]-D[a*4+a]+1);w[i]=.5*l;const M=.5/l;w[3]=(D[c*4+a]-D[a*4+c])*M,w[c]=(D[c*4+i]+D[i*4+c])*M,w[a]=(D[a*4+i]+D[i*4+a])*M}return w}function Tn(D,A,w,t,i){const c=i??new d(4),a=D*.5,l=A*.5,M=w*.5,p=Math.sin(a),n=Math.cos(a),u=Math.sin(l),s=Math.cos(l),o=Math.sin(M),e=Math.cos(M);switch(t){case"xyz":c[0]=p*s*e+n*u*o,c[1]=n*u*e-p*s*o,c[2]=n*s*o+p*u*e,c[3]=n*s*e-p*u*o;break;case"xzy":c[0]=p*s*e-n*u*o,c[1]=n*u*e-p*s*o,c[2]=n*s*o+p*u*e,c[3]=n*s*e+p*u*o;break;case"yxz":c[0]=p*s*e+n*u*o,c[1]=n*u*e-p*s*o,c[2]=n*s*o-p*u*e,c[3]=n*s*e+p*u*o;break;case"yzx":c[0]=p*s*e+n*u*o,c[1]=n*u*e+p*s*o,c[2]=n*s*o-p*u*e,c[3]=n*s*e-p*u*o;break;case"zxy":c[0]=p*s*e-n*u*o,c[1]=n*u*e+p*s*o,c[2]=n*s*o+p*u*e,c[3]=n*s*e-p*u*o;break;case"zyx":c[0]=p*s*e-n*u*o,c[1]=n*u*e+p*s*o,c[2]=n*s*o-p*u*e,c[3]=n*s*e+p*u*o;break;default:throw new Error(`Unknown rotation order: ${t}`)}return c}function dn(D,A){const w=A??new d(4);return w[0]=D[0],w[1]=D[1],w[2]=D[2],w[3]=D[3],w}const k=dn;function Vn(D,A,w){const t=w??new d(4);return t[0]=D[0]+A[0],t[1]=D[1]+A[1],t[2]=D[2]+A[2],t[3]=D[3]+A[3],t}function gn(D,A,w){const t=w??new d(4);return t[0]=D[0]-A[0],t[1]=D[1]-A[1],t[2]=D[2]-A[2],t[3]=D[3]-A[3],t}const zn=gn;function In(D,A,w){const t=w??new d(4);return t[0]=D[0]*A,t[1]=D[1]*A,t[2]=D[2]*A,t[3]=D[3]*A,t}const An=In;function Sn(D,A,w){const t=w??new d(4);return t[0]=D[0]/A,t[1]=D[1]/A,t[2]=D[2]/A,t[3]=D[3]/A,t}function _(D,A){return D[0]*A[0]+D[1]*A[1]+D[2]*A[2]+D[3]*A[3]}function Un(D,A,w,t){const i=t??new d(4);return i[0]=D[0]+w*(A[0]-D[0]),i[1]=D[1]+w*(A[1]-D[1]),i[2]=D[2]+w*(A[2]-D[2]),i[3]=D[3]+w*(A[3]-D[3]),i}function cn(D){const A=D[0],w=D[1],t=D[2],i=D[3];return Math.sqrt(A*A+w*w+t*t+i*i)}const vn=cn;function m(D){const A=D[0],w=D[1],t=D[2],i=D[3];return A*A+w*w+t*t+i*i}const G=m;function $(D,A){const w=A??new d(4),t=D[0],i=D[1],c=D[2],a=D[3],l=Math.sqrt(t*t+i*i+c*c+a*a);return l>1e-5?(w[0]=t/l,w[1]=i/l,w[2]=c/l,w[3]=a/l):(w[0]=0,w[1]=0,w[2]=0,w[3]=1),w}function U(D,A){return Math.abs(D[0]-A[0])<F&&Math.abs(D[1]-A[1])<F&&Math.abs(D[2]-A[2])<F&&Math.abs(D[3]-A[3])<F}function on(D,A){return D[0]===A[0]&&D[1]===A[1]&&D[2]===A[2]&&D[3]===A[3]}function Ln(D){const A=D??new d(4);return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}const X=x.create(),Gn=x.create(),Mn=x.create();function $n(D,A,w){const t=w??new d(4),i=x.dot(D,A);return i<-.999999?(x.cross(Gn,D,X),x.len(X)<1e-6&&x.cross(Mn,D,X),x.normalize(X,X),v(X,Math.PI,t),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(x.cross(D,A,X),t[0]=X[0],t[1]=X[1],t[2]=X[2],t[3]=1+i,$(t,t))}const pn=new d(4),Fn=new d(4);function On(D,A,w,t,i,c){const a=c??new d(4);return hn(D,t,i,pn),hn(A,w,i,Fn),hn(pn,Fn,2*i*(1-i),a),a}return{create:I,fromValues:L,set:O,fromAxisAngle:v,toAxisAngle:H,angle:wn,multiply:K,mul:Dn,rotateX:J,rotateY:Q,rotateZ:yn,slerp:hn,inverse:xn,conjugate:ln,fromMat:En,fromEuler:Tn,copy:dn,clone:k,add:Vn,subtract:gn,sub:zn,mulScalar:In,scale:An,divScalar:Sn,dot:_,lerp:Un,length:cn,len:vn,lengthSq:m,lenSq:G,normalize:$,equalsApproximately:U,equals:on,identity:Ln,rotationTo:$n,sqlerp:On}}const st=new Map;function Mt(d){let x=st.get(d);return x||(x=dt(d),st.set(d,x)),x}function pt(d){function x(w,t,i,c){const a=new d(4);return w!==void 0&&(a[0]=w,t!==void 0&&(a[1]=t,i!==void 0&&(a[2]=i,c!==void 0&&(a[3]=c)))),a}const I=x;function L(w,t,i,c,a){const l=a??new d(4);return l[0]=w,l[1]=t,l[2]=i,l[3]=c,l}function O(w,t){const i=t??new d(4);return i[0]=Math.ceil(w[0]),i[1]=Math.ceil(w[1]),i[2]=Math.ceil(w[2]),i[3]=Math.ceil(w[3]),i}function v(w,t){const i=t??new d(4);return i[0]=Math.floor(w[0]),i[1]=Math.floor(w[1]),i[2]=Math.floor(w[2]),i[3]=Math.floor(w[3]),i}function H(w,t){const i=t??new d(4);return i[0]=Math.round(w[0]),i[1]=Math.round(w[1]),i[2]=Math.round(w[2]),i[3]=Math.round(w[3]),i}function wn(w,t=0,i=1,c){const a=c??new d(4);return a[0]=Math.min(i,Math.max(t,w[0])),a[1]=Math.min(i,Math.max(t,w[1])),a[2]=Math.min(i,Math.max(t,w[2])),a[3]=Math.min(i,Math.max(t,w[3])),a}function K(w,t,i){const c=i??new d(4);return c[0]=w[0]+t[0],c[1]=w[1]+t[1],c[2]=w[2]+t[2],c[3]=w[3]+t[3],c}function Dn(w,t,i,c){const a=c??new d(4);return a[0]=w[0]+t[0]*i,a[1]=w[1]+t[1]*i,a[2]=w[2]+t[2]*i,a[3]=w[3]+t[3]*i,a}function J(w,t,i){const c=i??new d(4);return c[0]=w[0]-t[0],c[1]=w[1]-t[1],c[2]=w[2]-t[2],c[3]=w[3]-t[3],c}const Q=J;function yn(w,t){return Math.abs(w[0]-t[0])<F&&Math.abs(w[1]-t[1])<F&&Math.abs(w[2]-t[2])<F&&Math.abs(w[3]-t[3])<F}function hn(w,t){return w[0]===t[0]&&w[1]===t[1]&&w[2]===t[2]&&w[3]===t[3]}function xn(w,t,i,c){const a=c??new d(4);return a[0]=w[0]+i*(t[0]-w[0]),a[1]=w[1]+i*(t[1]-w[1]),a[2]=w[2]+i*(t[2]-w[2]),a[3]=w[3]+i*(t[3]-w[3]),a}function ln(w,t,i,c){const a=c??new d(4);return a[0]=w[0]+i[0]*(t[0]-w[0]),a[1]=w[1]+i[1]*(t[1]-w[1]),a[2]=w[2]+i[2]*(t[2]-w[2]),a[3]=w[3]+i[3]*(t[3]-w[3]),a}function En(w,t,i){const c=i??new d(4);return c[0]=Math.max(w[0],t[0]),c[1]=Math.max(w[1],t[1]),c[2]=Math.max(w[2],t[2]),c[3]=Math.max(w[3],t[3]),c}function Tn(w,t,i){const c=i??new d(4);return c[0]=Math.min(w[0],t[0]),c[1]=Math.min(w[1],t[1]),c[2]=Math.min(w[2],t[2]),c[3]=Math.min(w[3],t[3]),c}function dn(w,t,i){const c=i??new d(4);return c[0]=w[0]*t,c[1]=w[1]*t,c[2]=w[2]*t,c[3]=w[3]*t,c}const k=dn;function Vn(w,t,i){const c=i??new d(4);return c[0]=w[0]/t,c[1]=w[1]/t,c[2]=w[2]/t,c[3]=w[3]/t,c}function gn(w,t){const i=t??new d(4);return i[0]=1/w[0],i[1]=1/w[1],i[2]=1/w[2],i[3]=1/w[3],i}const zn=gn;function In(w,t){return w[0]*t[0]+w[1]*t[1]+w[2]*t[2]+w[3]*t[3]}function An(w){const t=w[0],i=w[1],c=w[2],a=w[3];return Math.sqrt(t*t+i*i+c*c+a*a)}const Sn=An;function _(w){const t=w[0],i=w[1],c=w[2],a=w[3];return t*t+i*i+c*c+a*a}const Un=_;function cn(w,t){const i=w[0]-t[0],c=w[1]-t[1],a=w[2]-t[2],l=w[3]-t[3];return Math.sqrt(i*i+c*c+a*a+l*l)}const vn=cn;function m(w,t){const i=w[0]-t[0],c=w[1]-t[1],a=w[2]-t[2],l=w[3]-t[3];return i*i+c*c+a*a+l*l}const G=m;function $(w,t){const i=t??new d(4),c=w[0],a=w[1],l=w[2],M=w[3],p=Math.sqrt(c*c+a*a+l*l+M*M);return p>1e-5?(i[0]=c/p,i[1]=a/p,i[2]=l/p,i[3]=M/p):(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function U(w,t){const i=t??new d(4);return i[0]=-w[0],i[1]=-w[1],i[2]=-w[2],i[3]=-w[3],i}function on(w,t){const i=t??new d(4);return i[0]=w[0],i[1]=w[1],i[2]=w[2],i[3]=w[3],i}const Ln=on;function X(w,t,i){const c=i??new d(4);return c[0]=w[0]*t[0],c[1]=w[1]*t[1],c[2]=w[2]*t[2],c[3]=w[3]*t[3],c}const Gn=X;function Mn(w,t,i){const c=i??new d(4);return c[0]=w[0]/t[0],c[1]=w[1]/t[1],c[2]=w[2]/t[2],c[3]=w[3]/t[3],c}const $n=Mn;function pn(w){const t=w??new d(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Fn(w,t,i){const c=i??new d(4),a=w[0],l=w[1],M=w[2],p=w[3];return c[0]=t[0]*a+t[4]*l+t[8]*M+t[12]*p,c[1]=t[1]*a+t[5]*l+t[9]*M+t[13]*p,c[2]=t[2]*a+t[6]*l+t[10]*M+t[14]*p,c[3]=t[3]*a+t[7]*l+t[11]*M+t[15]*p,c}function On(w,t,i){const c=i??new d(4);return $(w,c),dn(c,t,c)}function D(w,t,i){const c=i??new d(4);return An(w)>t?On(w,t,c):on(w,c)}function A(w,t,i){const c=i??new d(4);return xn(w,t,.5,c)}return{create:x,fromValues:I,set:L,ceil:O,floor:v,round:H,clamp:wn,add:K,addScaled:Dn,subtract:J,sub:Q,equalsApproximately:yn,equals:hn,lerp:xn,lerpV:ln,max:En,min:Tn,mulScalar:dn,scale:k,divScalar:Vn,inverse:gn,invert:zn,dot:In,length:An,len:Sn,lengthSq:_,lenSq:Un,distance:cn,dist:vn,distanceSq:m,distSq:G,normalize:$,negate:U,copy:on,clone:Ln,multiply:X,mul:Gn,divide:Mn,div:$n,zero:pn,transformMat4:Fn,setLength:On,truncate:D,midpoint:A}}const ct=new Map;function Dt(d){let x=ct.get(d);return x||(x=pt(d),ct.set(d,x)),x}function Kn(d,x,I,L,O,v){return{mat3:wt(d),mat4:lt(x),quat:Mt(I),vec2:ot(L),vec3:_n(O),vec4:Dt(v)}}const{mat4:Rn,vec3:jn}=Kn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Kn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Kn(it,Array,Array,Array,Array,Array);const yt=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),xt=new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1]),gt=new Uint16Array([0,1,2,0]);class zt{constructor(x){this.canvas=x,this.canvas=x,this.updateViewMatrix(),this.updatePerspectiveMatrix()}device;queue;presentationContext;presentationSize;presentationFormat;positionBuffer;colorBuffer;indexBuffer;uniformBuffer;vertexModule;fragmentModule;renderTarget;renderTargetView;depthTarget;depthTargetView;renderPipeline;commandEncoder;passEncoder;modelMatrix=Rn.identity();viewMatrix=Rn.identity();perspectiveMatrix=Rn.identity();eye=jn.create(0,0,5);zNear=.1;zFar=1e3;sampleCount=4;uniformBindGroup;updatePerspectiveMatrix(){const x=this.canvas.width/this.canvas.height,I=45*Math.PI/180;this.perspectiveMatrix=Rn.perspective(I,x,this.zNear,this.zFar)}updateViewMatrix(){const x=jn.create(0,0,0),I=jn.create(0,1,0);this.viewMatrix=Rn.lookAt(this.eye,x,I)}resize(x,I){(x!==this.presentationSize.width||I!==this.presentationSize.height)&&(this.canvas.width=x,this.canvas.height=I,this.presentationSize={width:x,height:I,depthOrArrayLayers:1},this.updatePerspectiveMatrix(),this.resizeSwapchain())}async initialize(){const x=navigator.gpu;if(!x)return console.error("No WebGPU support navigator.gpu not available!"),!1;const I=await x.requestAdapter();if(!I)return console.error("failed to get GPUAdapter, gpu: ",x),!1;console.log(I.limits),this.device=await I.requestDevice(),this.queue=this.device.queue,this.canvas.style.display="block",this.canvas.addEventListener("wheel",this.onMouseWheel),this.presentationSize={width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1};const L=this.canvas.getContext("webgpu");return L?(this.presentationContext=L,this.presentationFormat=x.getPreferredCanvasFormat(),this.presentationContext.configure({device:this.device,format:this.presentationFormat,alphaMode:"opaque"}),new ResizeObserver(v=>{Array.isArray(v)&&this.resize(v[0].contentRect.width*window.devicePixelRatio,v[0].contentRect.height*window.devicePixelRatio)}).observe(this.canvas),!0):(console.error("failed to get GPUCanvasContext"),!1)}onMouseWheel=x=>{let I=this.eye[2]+=x.deltaY*.01;I=Math.max(this.zNear,Math.min(this.zFar,I)),this.eye[2]=I};createBuffer(x,I){try{const L=this.device.createBuffer({mappedAtCreation:!0,size:x.byteLength,usage:I}),O=L.getMappedRange();return(x instanceof Float32Array?new Float32Array(O):new Uint16Array(O)).set(x),L.unmap(),L}catch(L){throw console.error(L),L}}createUBOArray(){const x=new Float32Array(48);return x.set(this.modelMatrix),x.set(this.viewMatrix,16),x.set(this.perspectiveMatrix,32),x}updateUniformBuffer(){this.updateViewMatrix();const x=this.createUBOArray();this.queue.writeBuffer(this.uniformBuffer,0,x.buffer)}async loadShader(x){const L=await(await fetch(x)).text();return this.device.createShaderModule({code:L})}resizeSwapchain(){this.renderTarget!==void 0&&(this.renderTarget.destroy(),this.depthTarget.destroy()),this.renderTarget=this.device.createTexture({size:this.presentationSize,sampleCount:this.sampleCount,format:this.presentationFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.renderTargetView=this.renderTarget.createView(),this.depthTarget=this.device.createTexture({size:this.presentationSize,sampleCount:this.sampleCount,format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTargetView=this.depthTarget.createView()}encodeCommands(){const x={view:this.presentationContext.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"};this.sampleCount>1&&(x.view=this.renderTargetView,x.resolveTarget=this.presentationContext.getCurrentTexture().createView());const I={view:this.depthTargetView,depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store",stencilLoadOp:"clear",stencilClearValue:0,stencilStoreOp:"store"},L={colorAttachments:[x],depthStencilAttachment:I};this.commandEncoder=this.device.createCommandEncoder(),this.passEncoder=this.commandEncoder.beginRenderPass(L),this.passEncoder.setPipeline(this.renderPipeline),this.passEncoder.setBindGroup(0,this.uniformBindGroup),this.passEncoder.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),this.passEncoder.setScissorRect(0,0,this.canvas.width,this.canvas.height),this.passEncoder.setVertexBuffer(0,this.positionBuffer),this.passEncoder.setVertexBuffer(1,this.colorBuffer),this.passEncoder.setIndexBuffer(this.indexBuffer,"uint16"),this.passEncoder.drawIndexed(3,1,0,0,0),this.passEncoder.end(),this.queue.submit([this.commandEncoder.finish()])}async initializeResources(){this.positionBuffer=this.createBuffer(yt,GPUBufferUsage.VERTEX),this.colorBuffer=this.createBuffer(xt,GPUBufferUsage.VERTEX),this.indexBuffer=this.createBuffer(gt,GPUBufferUsage.INDEX);const x=this.createUBOArray();this.uniformBuffer=this.createBuffer(x,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.vertexModule=await this.loadShader("./shaders/basic.vert.wgsl"),this.fragmentModule=await this.loadShader("./shaders/basic.frag.wgsl");const I={shaderLocation:0,offset:0,format:"float32x3"},L={shaderLocation:1,offset:0,format:"float32x4"},O={attributes:[I],arrayStride:4*3,stepMode:"vertex"},v={attributes:[L],arrayStride:4*4,stepMode:"vertex"},H={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},wn=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]});this.uniformBindGroup=this.device.createBindGroup({layout:wn,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const K=this.device.createPipelineLayout({bindGroupLayouts:[wn]}),Dn={module:this.vertexModule,entryPoint:"main",buffers:[O,v]},J={format:"bgra8unorm",blend:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},writeMask:GPUColorWrite.ALL},Q={module:this.fragmentModule,entryPoint:"main",targets:[J]},yn={layout:K,vertex:Dn,fragment:Q,primitive:{topology:"triangle-list",frontFace:"cw",cullMode:"none"},depthStencil:H,multisample:{count:this.sampleCount}};this.renderPipeline=this.device.createRenderPipeline(yn)}render=()=>{const x=.5*Math.PI/180;Rn.rotateZ(this.modelMatrix,x,this.modelMatrix),this.updateUniformBuffer(),this.encodeCommands(),requestAnimationFrame(this.render)};async start(){if(await this.initialize())this.resizeSwapchain(),await this.initializeResources(),this.render();else{const x=document.getElementById("error");x&&(x.style.display="block")}}}const At=document.getElementById("webgpu_canvas"),St=new zt(At);St.start();
