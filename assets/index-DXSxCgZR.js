var Bn=Object.defineProperty;var Pn=(e,n,o)=>n in e?Bn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o;var A=(e,n,o)=>(Pn(e,typeof n!="symbol"?n+"":n,o),o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const t of c)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(c){const t={};return c.integrity&&(t.integrity=c.integrity),c.referrerPolicy&&(t.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?t.credentials="include":c.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(c){if(c.ep)return;c.ep=!0;const t=o(c);fetch(c.href,t)}})();let E=1e-6,s=Float32Array;function qn(e){const n=s;return s=e,n}function _(e,n,o){const r=new s(3);return e!==void 0&&(r[0]=e,n!==void 0&&(r[1]=n,o!==void 0&&(r[2]=o))),r}const En=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);En.get(Float32Array);const Cn=_;function On(e,n,o,r){return r=r||new s(3),r[0]=e,r[1]=n,r[2]=o,r}function Un(e,n){return n=n||new s(3),n[0]=Math.ceil(e[0]),n[1]=Math.ceil(e[1]),n[2]=Math.ceil(e[2]),n}function Vn(e,n){return n=n||new s(3),n[0]=Math.floor(e[0]),n[1]=Math.floor(e[1]),n[2]=Math.floor(e[2]),n}function Fn(e,n){return n=n||new s(3),n[0]=Math.round(e[0]),n[1]=Math.round(e[1]),n[2]=Math.round(e[2]),n}function Ln(e,n=0,o=1,r){return r=r||new s(3),r[0]=Math.min(o,Math.max(n,e[0])),r[1]=Math.min(o,Math.max(n,e[1])),r[2]=Math.min(o,Math.max(n,e[2])),r}function mn(e,n,o){return o=o||new s(3),o[0]=e[0]+n[0],o[1]=e[1]+n[1],o[2]=e[2]+n[2],o}function Gn(e,n,o,r){return r=r||new s(3),r[0]=e[0]+n[0]*o,r[1]=e[1]+n[1]*o,r[2]=e[2]+n[2]*o,r}function Rn(e,n){const o=e[0],r=e[1],c=e[2],t=e[0],i=e[1],h=e[2],p=Math.sqrt(o*o+r*r+c*c),M=Math.sqrt(t*t+i*i+h*h),l=p*M,a=l&&Mn(e,n)/l;return Math.acos(a)}function j(e,n,o){return o=o||new s(3),o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],o}const Nn=j;function Dn(e,n){return Math.abs(e[0]-n[0])<E&&Math.abs(e[1]-n[1])<E&&Math.abs(e[2]-n[2])<E}function In(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function ln(e,n,o,r){return r=r||new s(3),r[0]=e[0]+o*(n[0]-e[0]),r[1]=e[1]+o*(n[1]-e[1]),r[2]=e[2]+o*(n[2]-e[2]),r}function _n(e,n,o,r){return r=r||new s(3),r[0]=e[0]+o[0]*(n[0]-e[0]),r[1]=e[1]+o[1]*(n[1]-e[1]),r[2]=e[2]+o[2]*(n[2]-e[2]),r}function Xn(e,n,o){return o=o||new s(3),o[0]=Math.max(e[0],n[0]),o[1]=Math.max(e[1],n[1]),o[2]=Math.max(e[2],n[2]),o}function Yn(e,n,o){return o=o||new s(3),o[0]=Math.min(e[0],n[0]),o[1]=Math.min(e[1],n[1]),o[2]=Math.min(e[2],n[2]),o}function on(e,n,o){return o=o||new s(3),o[0]=e[0]*n,o[1]=e[1]*n,o[2]=e[2]*n,o}const Zn=on;function Wn(e,n,o){return o=o||new s(3),o[0]=e[0]/n,o[1]=e[1]/n,o[2]=e[2]/n,o}function pn(e,n){return n=n||new s(3),n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}const Qn=pn;function W(e,n,o){o=o||new s(3);const r=e[2]*n[0]-e[0]*n[2],c=e[0]*n[1]-e[1]*n[0];return o[0]=e[1]*n[2]-e[2]*n[1],o[1]=r,o[2]=c,o}function Mn(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function rn(e){const n=e[0],o=e[1],r=e[2];return Math.sqrt(n*n+o*o+r*r)}const jn=rn;function wn(e){const n=e[0],o=e[1],r=e[2];return n*n+o*o+r*r}const Hn=wn;function sn(e,n){const o=e[0]-n[0],r=e[1]-n[1],c=e[2]-n[2];return Math.sqrt(o*o+r*r+c*c)}const Kn=sn;function yn(e,n){const o=e[0]-n[0],r=e[1]-n[1],c=e[2]-n[2];return o*o+r*r+c*c}const Jn=yn;function Z(e,n){n=n||new s(3);const o=e[0],r=e[1],c=e[2],t=Math.sqrt(o*o+r*r+c*c);return t>1e-5?(n[0]=o/t,n[1]=r/t,n[2]=c/t):(n[0]=0,n[1]=0,n[2]=0),n}function kn(e,n){return n=n||new s(3),n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function cn(e,n){return n=n||new s(3),n[0]=e[0],n[1]=e[1],n[2]=e[2],n}const bn=cn;function gn(e,n,o){return o=o||new s(3),o[0]=e[0]*n[0],o[1]=e[1]*n[1],o[2]=e[2]*n[2],o}const dn=gn;function xn(e,n,o){return o=o||new s(3),o[0]=e[0]/n[0],o[1]=e[1]/n[1],o[2]=e[2]/n[2],o}const ne=xn;function ee(e=1,n){n=n||new s(3);const o=Math.random()*2*Math.PI,r=Math.random()*2-1,c=Math.sqrt(1-r*r)*e;return n[0]=Math.cos(o)*c,n[1]=Math.sin(o)*c,n[2]=r*e,n}function oe(e){return e=e||new s(3),e[0]=0,e[1]=0,e[2]=0,e}function re(e,n,o){o=o||new s(3);const r=e[0],c=e[1],t=e[2],i=n[3]*r+n[7]*c+n[11]*t+n[15]||1;return o[0]=(n[0]*r+n[4]*c+n[8]*t+n[12])/i,o[1]=(n[1]*r+n[5]*c+n[9]*t+n[13])/i,o[2]=(n[2]*r+n[6]*c+n[10]*t+n[14])/i,o}function ce(e,n,o){o=o||new s(3);const r=e[0],c=e[1],t=e[2];return o[0]=r*n[0*4+0]+c*n[1*4+0]+t*n[2*4+0],o[1]=r*n[0*4+1]+c*n[1*4+1]+t*n[2*4+1],o[2]=r*n[0*4+2]+c*n[1*4+2]+t*n[2*4+2],o}function te(e,n,o){o=o||new s(3);const r=e[0],c=e[1],t=e[2];return o[0]=r*n[0]+c*n[4]+t*n[8],o[1]=r*n[1]+c*n[5]+t*n[9],o[2]=r*n[2]+c*n[6]+t*n[10],o}function ie(e,n,o){o=o||new s(3);const r=n[0],c=n[1],t=n[2],i=n[3]*2,h=e[0],p=e[1],M=e[2],l=c*M-t*p,a=t*h-r*M,u=r*p-c*h;return o[0]=h+l*i+(c*u-t*a)*2,o[1]=p+a*i+(t*l-r*u)*2,o[2]=M+u*i+(r*a-c*l)*2,o}function ae(e,n){return n=n||new s(3),n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function ue(e,n,o){o=o||new s(3);const r=n*4;return o[0]=e[r+0],o[1]=e[r+1],o[2]=e[r+2],o}function fe(e,n){n=n||new s(3);const o=e[0],r=e[1],c=e[2],t=e[4],i=e[5],h=e[6],p=e[8],M=e[9],l=e[10];return n[0]=Math.sqrt(o*o+r*r+c*c),n[1]=Math.sqrt(t*t+i*i+h*h),n[2]=Math.sqrt(p*p+M*M+l*l),n}function he(e,n,o,r){r=r||new s(3);const c=[],t=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],t[0]=c[0],t[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),t[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function le(e,n,o,r){r=r||new s(3);const c=[],t=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],t[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),t[1]=c[1],t[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function pe(e,n,o,r){r=r||new s(3);const c=[],t=[];return c[0]=e[0]-n[0],c[1]=e[1]-n[1],c[2]=e[2]-n[2],t[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),t[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),t[2]=c[2],r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function $n(e,n,o){return o=o||new s(3),Z(e,o),on(o,n,o)}function Me(e,n,o){return o=o||new s(3),rn(e)>n?$n(e,n,o):cn(e,o)}function we(e,n,o){return o=o||new s(3),ln(e,n,.5,o)}var en=Object.freeze({__proto__:null,add:mn,addScaled:Gn,angle:Rn,ceil:Un,clamp:Ln,clone:bn,copy:cn,create:_,cross:W,dist:Kn,distSq:Jn,distance:sn,distanceSq:yn,div:ne,divScalar:Wn,divide:xn,dot:Mn,equals:In,equalsApproximately:Dn,floor:Vn,fromValues:Cn,getAxis:ue,getScaling:fe,getTranslation:ae,inverse:pn,invert:Qn,len:jn,lenSq:Hn,length:rn,lengthSq:wn,lerp:ln,lerpV:_n,max:Xn,midpoint:we,min:Yn,mul:dn,mulScalar:on,multiply:gn,negate:kn,normalize:Z,random:ee,rotateX:he,rotateY:le,rotateZ:pe,round:Fn,scale:Zn,set:On,setDefaultType:qn,setLength:$n,sub:Nn,subtract:j,transformMat3:te,transformMat4:re,transformMat4Upper3x3:ce,transformQuat:ie,truncate:Me,zero:oe});let $=Float32Array;function se(e){const n=$;return $=e,n}function ye(e,n,o,r,c,t,i,h,p,M,l,a,u,y,w,g){const f=new $(16);return e!==void 0&&(f[0]=e,n!==void 0&&(f[1]=n,o!==void 0&&(f[2]=o,r!==void 0&&(f[3]=r,c!==void 0&&(f[4]=c,t!==void 0&&(f[5]=t,i!==void 0&&(f[6]=i,h!==void 0&&(f[7]=h,p!==void 0&&(f[8]=p,M!==void 0&&(f[9]=M,l!==void 0&&(f[10]=l,a!==void 0&&(f[11]=a,u!==void 0&&(f[12]=u,y!==void 0&&(f[13]=y,w!==void 0&&(f[14]=w,g!==void 0&&(f[15]=g)))))))))))))))),f}function ge(e,n,o,r,c,t,i,h,p,M,l,a,u,y,w,g,f){return f=f||new $(16),f[0]=e,f[1]=n,f[2]=o,f[3]=r,f[4]=c,f[5]=t,f[6]=i,f[7]=h,f[8]=p,f[9]=M,f[10]=l,f[11]=a,f[12]=u,f[13]=y,f[14]=w,f[15]=g,f}function xe(e,n){return n=n||new $(16),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=0,n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=0,n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function $e(e,n){n=n||new $(16);const o=e[0],r=e[1],c=e[2],t=e[3],i=o+o,h=r+r,p=c+c,M=o*i,l=r*i,a=r*h,u=c*i,y=c*h,w=c*p,g=t*i,f=t*h,z=t*p;return n[0]=1-a-w,n[1]=l+z,n[2]=u-f,n[3]=0,n[4]=l-z,n[5]=1-M-w,n[6]=y+g,n[7]=0,n[8]=u+f,n[9]=y-g,n[10]=1-M-a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ze(e,n){return n=n||new $(16),n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=-e[3],n[4]=-e[4],n[5]=-e[5],n[6]=-e[6],n[7]=-e[7],n[8]=-e[8],n[9]=-e[9],n[10]=-e[10],n[11]=-e[11],n[12]=-e[12],n[13]=-e[13],n[14]=-e[14],n[15]=-e[15],n}function tn(e,n){return n=n||new $(16),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}const Ae=tn;function Se(e,n){return Math.abs(e[0]-n[0])<E&&Math.abs(e[1]-n[1])<E&&Math.abs(e[2]-n[2])<E&&Math.abs(e[3]-n[3])<E&&Math.abs(e[4]-n[4])<E&&Math.abs(e[5]-n[5])<E&&Math.abs(e[6]-n[6])<E&&Math.abs(e[7]-n[7])<E&&Math.abs(e[8]-n[8])<E&&Math.abs(e[9]-n[9])<E&&Math.abs(e[10]-n[10])<E&&Math.abs(e[11]-n[11])<E&&Math.abs(e[12]-n[12])<E&&Math.abs(e[13]-n[13])<E&&Math.abs(e[14]-n[14])<E&&Math.abs(e[15]-n[15])<E}function ve(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function zn(e){return e=e||new $(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Te(e,n){if(n=n||new $(16),n===e){let x;return x=e[1],e[1]=e[4],e[4]=x,x=e[2],e[2]=e[8],e[8]=x,x=e[3],e[3]=e[12],e[12]=x,x=e[6],e[6]=e[9],e[9]=x,x=e[7],e[7]=e[13],e[13]=x,x=e[11],e[11]=e[14],e[14]=x,n}const o=e[0*4+0],r=e[0*4+1],c=e[0*4+2],t=e[0*4+3],i=e[1*4+0],h=e[1*4+1],p=e[1*4+2],M=e[1*4+3],l=e[2*4+0],a=e[2*4+1],u=e[2*4+2],y=e[2*4+3],w=e[3*4+0],g=e[3*4+1],f=e[3*4+2],z=e[3*4+3];return n[0]=o,n[1]=i,n[2]=l,n[3]=w,n[4]=r,n[5]=h,n[6]=a,n[7]=g,n[8]=c,n[9]=p,n[10]=u,n[11]=f,n[12]=t,n[13]=M,n[14]=y,n[15]=z,n}function An(e,n){n=n||new $(16);const o=e[0*4+0],r=e[0*4+1],c=e[0*4+2],t=e[0*4+3],i=e[1*4+0],h=e[1*4+1],p=e[1*4+2],M=e[1*4+3],l=e[2*4+0],a=e[2*4+1],u=e[2*4+2],y=e[2*4+3],w=e[3*4+0],g=e[3*4+1],f=e[3*4+2],z=e[3*4+3],x=u*z,B=f*y,P=p*z,q=f*M,C=p*y,O=u*M,U=c*z,V=f*t,F=c*y,L=u*t,m=c*M,R=p*t,N=l*g,D=w*a,I=i*g,X=w*h,Y=i*a,H=l*h,K=o*g,J=w*r,k=o*a,b=l*r,d=o*h,nn=i*r,an=x*h+q*a+C*g-(B*h+P*a+O*g),un=B*r+U*a+L*g-(x*r+V*a+F*g),fn=P*r+V*h+m*g-(q*r+U*h+R*g),hn=O*r+F*h+R*a-(C*r+L*h+m*a),G=1/(o*an+i*un+l*fn+w*hn);return n[0]=G*an,n[1]=G*un,n[2]=G*fn,n[3]=G*hn,n[4]=G*(B*i+P*l+O*w-(x*i+q*l+C*w)),n[5]=G*(x*o+V*l+F*w-(B*o+U*l+L*w)),n[6]=G*(q*o+U*i+R*w-(P*o+V*i+m*w)),n[7]=G*(C*o+L*i+m*l-(O*o+F*i+R*l)),n[8]=G*(N*M+X*y+Y*z-(D*M+I*y+H*z)),n[9]=G*(D*t+K*y+b*z-(N*t+J*y+k*z)),n[10]=G*(I*t+J*M+d*z-(X*t+K*M+nn*z)),n[11]=G*(H*t+k*M+nn*y-(Y*t+b*M+d*y)),n[12]=G*(I*u+H*f+D*p-(Y*f+N*p+X*u)),n[13]=G*(k*f+N*c+J*u-(K*u+b*f+D*c)),n[14]=G*(K*p+nn*f+X*c-(d*f+I*c+J*p)),n[15]=G*(d*u+Y*c+b*p-(k*p+nn*u+H*c)),n}function Be(e){const n=e[0],o=e[0*4+1],r=e[0*4+2],c=e[0*4+3],t=e[1*4+0],i=e[1*4+1],h=e[1*4+2],p=e[1*4+3],M=e[2*4+0],l=e[2*4+1],a=e[2*4+2],u=e[2*4+3],y=e[3*4+0],w=e[3*4+1],g=e[3*4+2],f=e[3*4+3],z=a*f,x=g*u,B=h*f,P=g*p,q=h*u,C=a*p,O=r*f,U=g*c,V=r*u,F=a*c,L=r*p,m=h*c,R=z*i+P*l+q*w-(x*i+B*l+C*w),N=x*o+O*l+F*w-(z*o+U*l+V*w),D=B*o+U*i+L*w-(P*o+O*i+m*w),I=C*o+V*i+m*l-(q*o+F*i+L*l);return n*R+t*N+M*D+y*I}const Pe=An;function Sn(e,n,o){o=o||new $(16);const r=e[0],c=e[1],t=e[2],i=e[3],h=e[4],p=e[5],M=e[6],l=e[7],a=e[8],u=e[9],y=e[10],w=e[11],g=e[12],f=e[13],z=e[14],x=e[15],B=n[0],P=n[1],q=n[2],C=n[3],O=n[4],U=n[5],V=n[6],F=n[7],L=n[8],m=n[9],R=n[10],N=n[11],D=n[12],I=n[13],X=n[14],Y=n[15];return o[0]=r*B+h*P+a*q+g*C,o[1]=c*B+p*P+u*q+f*C,o[2]=t*B+M*P+y*q+z*C,o[3]=i*B+l*P+w*q+x*C,o[4]=r*O+h*U+a*V+g*F,o[5]=c*O+p*U+u*V+f*F,o[6]=t*O+M*U+y*V+z*F,o[7]=i*O+l*U+w*V+x*F,o[8]=r*L+h*m+a*R+g*N,o[9]=c*L+p*m+u*R+f*N,o[10]=t*L+M*m+y*R+z*N,o[11]=i*L+l*m+w*R+x*N,o[12]=r*D+h*I+a*X+g*Y,o[13]=c*D+p*I+u*X+f*Y,o[14]=t*D+M*I+y*X+z*Y,o[15]=i*D+l*I+w*X+x*Y,o}const qe=Sn;function Ee(e,n,o){return o=o||zn(),e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11]),o[12]=n[0],o[13]=n[1],o[14]=n[2],o[15]=1,o}function Ce(e,n){return n=n||_(),n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function Oe(e,n,o){o=o||_();const r=n*4;return o[0]=e[r+0],o[1]=e[r+1],o[2]=e[r+2],o}function Ue(e,n,o,r){r!==e&&(r=tn(e,r));const c=o*4;return r[c+0]=n[0],r[c+1]=n[1],r[c+2]=n[2],r}function Ve(e,n){n=n||_();const o=e[0],r=e[1],c=e[2],t=e[4],i=e[5],h=e[6],p=e[8],M=e[9],l=e[10];return n[0]=Math.sqrt(o*o+r*r+c*c),n[1]=Math.sqrt(t*t+i*i+h*h),n[2]=Math.sqrt(p*p+M*M+l*l),n}function Fe(e,n,o,r,c){c=c||new $(16);const t=Math.tan(Math.PI*.5-.5*e);if(c[0]=t/n,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=t,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,r===1/0)c[10]=-1,c[14]=-o;else{const i=1/(o-r);c[10]=r*i,c[14]=r*o*i}return c}function Le(e,n,o,r,c,t,i){return i=i||new $(16),i[0]=2/(n-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(r-o),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1/(c-t),i[11]=0,i[12]=(n+e)/(e-n),i[13]=(r+o)/(o-r),i[14]=c/(c-t),i[15]=1,i}function me(e,n,o,r,c,t,i){i=i||new $(16);const h=n-e,p=r-o,M=c-t;return i[0]=2*c/h,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*c/p,i[6]=0,i[7]=0,i[8]=(e+n)/h,i[9]=(r+o)/p,i[10]=t/M,i[11]=-1,i[12]=0,i[13]=0,i[14]=c*t/M,i[15]=0,i}let v,T,S;function Ge(e,n,o,r){return r=r||new $(16),v=v||_(),T=T||_(),S=S||_(),Z(j(n,e,S),S),Z(W(o,S,v),v),Z(W(S,v,T),T),r[0]=v[0],r[1]=v[1],r[2]=v[2],r[3]=0,r[4]=T[0],r[5]=T[1],r[6]=T[2],r[7]=0,r[8]=S[0],r[9]=S[1],r[10]=S[2],r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Re(e,n,o,r){return r=r||new $(16),v=v||_(),T=T||_(),S=S||_(),Z(j(e,n,S),S),Z(W(o,S,v),v),Z(W(S,v,T),T),r[0]=v[0],r[1]=v[1],r[2]=v[2],r[3]=0,r[4]=T[0],r[5]=T[1],r[6]=T[2],r[7]=0,r[8]=S[0],r[9]=S[1],r[10]=S[2],r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Ne(e,n,o,r){return r=r||new $(16),v=v||_(),T=T||_(),S=S||_(),Z(j(e,n,S),S),Z(W(o,S,v),v),Z(W(S,v,T),T),r[0]=v[0],r[1]=T[0],r[2]=S[0],r[3]=0,r[4]=v[1],r[5]=T[1],r[6]=S[1],r[7]=0,r[8]=v[2],r[9]=T[2],r[10]=S[2],r[11]=0,r[12]=-(v[0]*e[0]+v[1]*e[1]+v[2]*e[2]),r[13]=-(T[0]*e[0]+T[1]*e[1]+T[2]*e[2]),r[14]=-(S[0]*e[0]+S[1]*e[1]+S[2]*e[2]),r[15]=1,r}function De(e,n){return n=n||new $(16),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function Ie(e,n,o){o=o||new $(16);const r=n[0],c=n[1],t=n[2],i=e[0],h=e[1],p=e[2],M=e[3],l=e[1*4+0],a=e[1*4+1],u=e[1*4+2],y=e[1*4+3],w=e[2*4+0],g=e[2*4+1],f=e[2*4+2],z=e[2*4+3],x=e[3*4+0],B=e[3*4+1],P=e[3*4+2],q=e[3*4+3];return e!==o&&(o[0]=i,o[1]=h,o[2]=p,o[3]=M,o[4]=l,o[5]=a,o[6]=u,o[7]=y,o[8]=w,o[9]=g,o[10]=f,o[11]=z),o[12]=i*r+l*c+w*t+x,o[13]=h*r+a*c+g*t+B,o[14]=p*r+u*c+f*t+P,o[15]=M*r+y*c+z*t+q,o}function _e(e,n){n=n||new $(16);const o=Math.cos(e),r=Math.sin(e);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=r,n[7]=0,n[8]=0,n[9]=-r,n[10]=o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Xe(e,n,o){o=o||new $(16);const r=e[4],c=e[5],t=e[6],i=e[7],h=e[8],p=e[9],M=e[10],l=e[11],a=Math.cos(n),u=Math.sin(n);return o[4]=a*r+u*h,o[5]=a*c+u*p,o[6]=a*t+u*M,o[7]=a*i+u*l,o[8]=a*h-u*r,o[9]=a*p-u*c,o[10]=a*M-u*t,o[11]=a*l-u*i,e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function Ye(e,n){n=n||new $(16);const o=Math.cos(e),r=Math.sin(e);return n[0]=o,n[1]=0,n[2]=-r,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=r,n[9]=0,n[10]=o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ze(e,n,o){o=o||new $(16);const r=e[0*4+0],c=e[0*4+1],t=e[0*4+2],i=e[0*4+3],h=e[2*4+0],p=e[2*4+1],M=e[2*4+2],l=e[2*4+3],a=Math.cos(n),u=Math.sin(n);return o[0]=a*r-u*h,o[1]=a*c-u*p,o[2]=a*t-u*M,o[3]=a*i-u*l,o[8]=a*h+u*r,o[9]=a*p+u*c,o[10]=a*M+u*t,o[11]=a*l+u*i,e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function We(e,n){n=n||new $(16);const o=Math.cos(e),r=Math.sin(e);return n[0]=o,n[1]=r,n[2]=0,n[3]=0,n[4]=-r,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Qe(e,n,o){o=o||new $(16);const r=e[0*4+0],c=e[0*4+1],t=e[0*4+2],i=e[0*4+3],h=e[1*4+0],p=e[1*4+1],M=e[1*4+2],l=e[1*4+3],a=Math.cos(n),u=Math.sin(n);return o[0]=a*r+u*h,o[1]=a*c+u*p,o[2]=a*t+u*M,o[3]=a*i+u*l,o[4]=a*h-u*r,o[5]=a*p-u*c,o[6]=a*M-u*t,o[7]=a*l-u*i,e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function vn(e,n,o){o=o||new $(16);let r=e[0],c=e[1],t=e[2];const i=Math.sqrt(r*r+c*c+t*t);r/=i,c/=i,t/=i;const h=r*r,p=c*c,M=t*t,l=Math.cos(n),a=Math.sin(n),u=1-l;return o[0]=h+(1-h)*l,o[1]=r*c*u+t*a,o[2]=r*t*u-c*a,o[3]=0,o[4]=r*c*u-t*a,o[5]=p+(1-p)*l,o[6]=c*t*u+r*a,o[7]=0,o[8]=r*t*u+c*a,o[9]=c*t*u-r*a,o[10]=M+(1-M)*l,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}const je=vn;function Tn(e,n,o,r){r=r||new $(16);let c=n[0],t=n[1],i=n[2];const h=Math.sqrt(c*c+t*t+i*i);c/=h,t/=h,i/=h;const p=c*c,M=t*t,l=i*i,a=Math.cos(o),u=Math.sin(o),y=1-a,w=p+(1-p)*a,g=c*t*y+i*u,f=c*i*y-t*u,z=c*t*y-i*u,x=M+(1-M)*a,B=t*i*y+c*u,P=c*i*y+t*u,q=t*i*y-c*u,C=l+(1-l)*a,O=e[0],U=e[1],V=e[2],F=e[3],L=e[4],m=e[5],R=e[6],N=e[7],D=e[8],I=e[9],X=e[10],Y=e[11];return r[0]=w*O+g*L+f*D,r[1]=w*U+g*m+f*I,r[2]=w*V+g*R+f*X,r[3]=w*F+g*N+f*Y,r[4]=z*O+x*L+B*D,r[5]=z*U+x*m+B*I,r[6]=z*V+x*R+B*X,r[7]=z*F+x*N+B*Y,r[8]=P*O+q*L+C*D,r[9]=P*U+q*m+C*I,r[10]=P*V+q*R+C*X,r[11]=P*F+q*N+C*Y,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r}const He=Tn;function Ke(e,n){return n=n||new $(16),n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Je(e,n,o){o=o||new $(16);const r=n[0],c=n[1],t=n[2];return o[0]=r*e[0*4+0],o[1]=r*e[0*4+1],o[2]=r*e[0*4+2],o[3]=r*e[0*4+3],o[4]=c*e[1*4+0],o[5]=c*e[1*4+1],o[6]=c*e[1*4+2],o[7]=c*e[1*4+3],o[8]=t*e[2*4+0],o[9]=t*e[2*4+1],o[10]=t*e[2*4+2],o[11]=t*e[2*4+3],e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function ke(e,n){return n=n||new $(16),n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function be(e,n,o){return o=o||new $(16),o[0]=n*e[0*4+0],o[1]=n*e[0*4+1],o[2]=n*e[0*4+2],o[3]=n*e[0*4+3],o[4]=n*e[1*4+0],o[5]=n*e[1*4+1],o[6]=n*e[1*4+2],o[7]=n*e[1*4+3],o[8]=n*e[2*4+0],o[9]=n*e[2*4+1],o[10]=n*e[2*4+2],o[11]=n*e[2*4+3],e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}var Q=Object.freeze({__proto__:null,aim:Ge,axisRotate:Tn,axisRotation:vn,cameraAim:Re,clone:Ae,copy:tn,create:ye,determinant:Be,equals:ve,equalsApproximately:Se,fromMat3:xe,fromQuat:$e,frustum:me,getAxis:Oe,getScaling:Ve,getTranslation:Ce,identity:zn,inverse:An,invert:Pe,lookAt:Ne,mul:qe,multiply:Sn,negate:ze,ortho:Le,perspective:Fe,rotate:He,rotateX:Xe,rotateY:Ze,rotateZ:Qe,rotation:je,rotationX:_e,rotationY:Ye,rotationZ:We,scale:Je,scaling:Ke,set:ge,setAxis:Ue,setDefaultType:se,setTranslation:Ee,translate:Ie,translation:De,transpose:Te,uniformScale:be,uniformScaling:ke});const de=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),no=new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1]),eo=new Uint16Array([0,1,2,0]);class oo{constructor(n){A(this,"canvas");A(this,"device");A(this,"queue");A(this,"presentationContext");A(this,"presentationSize");A(this,"presentationFormat");A(this,"positionBuffer");A(this,"colorBuffer");A(this,"indexBuffer");A(this,"uniformBuffer");A(this,"vertexModule");A(this,"fragmentModule");A(this,"renderTarget");A(this,"renderTargetView");A(this,"depthTarget");A(this,"depthTargetView");A(this,"renderPipeline");A(this,"commandEncoder");A(this,"passEncoder");A(this,"modelMatrix",Q.identity());A(this,"viewMatrix",Q.identity());A(this,"perspectiveMatrix",Q.identity());A(this,"eye",en.create(0,0,5));A(this,"zNear",.1);A(this,"zFar",1e3);A(this,"sampleCount",4);A(this,"uniformBindGroup");A(this,"onMouseWheel",n=>{let o=this.eye[2]+=n.deltaY*.01;o=Math.max(this.zNear,Math.min(this.zFar,o)),this.eye[2]=o});A(this,"render",()=>{const n=.5*Math.PI/180;Q.rotateZ(this.modelMatrix,n,this.modelMatrix),this.updateUniformBuffer(),this.encodeCommands(),requestAnimationFrame(this.render)});this.canvas=n,this.updateViewMatrix(),this.updatePerspectiveMatrix()}updatePerspectiveMatrix(){const n=this.canvas.width/this.canvas.height,o=45*Math.PI/180;this.perspectiveMatrix=Q.perspective(o,n,this.zNear,this.zFar)}updateViewMatrix(){const n=en.create(0,0,0),o=en.create(0,1,0);this.viewMatrix=Q.lookAt(this.eye,n,o)}resize(n,o){(n!==this.presentationSize.width||o!==this.presentationSize.height)&&(this.canvas.width=n,this.canvas.height=o,this.presentationSize={width:n,height:o,depthOrArrayLayers:1},this.updatePerspectiveMatrix(),this.resizeSwapchain())}async initialize(){const n=navigator.gpu;if(!n)return console.error("No WebGPU support navigator.gpu not available!"),!1;const o=await n.requestAdapter();return console.log(o.limits),this.device=await o.requestDevice(),this.queue=this.device.queue,this.canvas.style.display="block",this.canvas.addEventListener("wheel",this.onMouseWheel),this.presentationSize={width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},this.presentationContext=this.canvas.getContext("webgpu"),this.presentationFormat=n.getPreferredCanvasFormat(),this.presentationContext.configure({device:this.device,format:this.presentationFormat,alphaMode:"opaque"}),new ResizeObserver(c=>{Array.isArray(c)&&this.resize(c[0].contentRect.width*window.devicePixelRatio,c[0].contentRect.height*window.devicePixelRatio)}).observe(this.canvas),!0}createBuffer(n,o){try{const r=this.device.createBuffer({mappedAtCreation:!0,size:n.byteLength,usage:o}),c=r.getMappedRange();return(n instanceof Float32Array?new Float32Array(c):new Uint16Array(c)).set(n),r.unmap(),r}catch(r){console.error(r)}}createUBOArray(){const n=new Float32Array(48);return n.set(this.modelMatrix),n.set(this.viewMatrix,16),n.set(this.perspectiveMatrix,32),n}updateUniformBuffer(){this.updateViewMatrix();const n=this.createUBOArray();this.queue.writeBuffer(this.uniformBuffer,0,n.buffer)}async loadShader(n){const o=await fetch(n);return this.device.createShaderModule({code:await o.text()})}resizeSwapchain(){this.renderTarget!==void 0&&(this.renderTarget.destroy(),this.depthTarget.destroy()),this.renderTarget=this.device.createTexture({size:this.presentationSize,sampleCount:this.sampleCount,format:this.presentationFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.renderTargetView=this.renderTarget.createView(),this.depthTarget=this.device.createTexture({size:this.presentationSize,sampleCount:this.sampleCount,format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTargetView=this.depthTarget.createView()}encodeCommands(){const n={view:this.presentationContext.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"};this.sampleCount>1&&(n.view=this.renderTargetView,n.resolveTarget=this.presentationContext.getCurrentTexture().createView());const o={view:this.depthTargetView,depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store",stencilLoadOp:"clear",stencilClearValue:0,stencilStoreOp:"store"},r={colorAttachments:[n],depthStencilAttachment:o};this.commandEncoder=this.device.createCommandEncoder(),this.passEncoder=this.commandEncoder.beginRenderPass(r),this.passEncoder.setPipeline(this.renderPipeline),this.passEncoder.setBindGroup(0,this.uniformBindGroup),this.passEncoder.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),this.passEncoder.setScissorRect(0,0,this.canvas.width,this.canvas.height),this.passEncoder.setVertexBuffer(0,this.positionBuffer),this.passEncoder.setVertexBuffer(1,this.colorBuffer),this.passEncoder.setIndexBuffer(this.indexBuffer,"uint16"),this.passEncoder.drawIndexed(3,1,0,0,0),this.passEncoder.end(),this.queue.submit([this.commandEncoder.finish()])}async initializeResources(){this.positionBuffer=this.createBuffer(de,GPUBufferUsage.VERTEX),this.colorBuffer=this.createBuffer(no,GPUBufferUsage.VERTEX),this.indexBuffer=this.createBuffer(eo,GPUBufferUsage.INDEX);const n=this.createUBOArray();this.uniformBuffer=this.createBuffer(n,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.vertexModule=await this.loadShader("./shaders/basic.vert.wgsl"),this.fragmentModule=await this.loadShader("./shaders/basic.frag.wgsl");const o={shaderLocation:0,offset:0,format:"float32x3"},r={shaderLocation:1,offset:0,format:"float32x4"},c={attributes:[o],arrayStride:4*3,stepMode:"vertex"},t={attributes:[r],arrayStride:4*4,stepMode:"vertex"},i={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},h=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]});this.uniformBindGroup=this.device.createBindGroup({layout:h,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const p=this.device.createPipelineLayout({bindGroupLayouts:[h]}),M={module:this.vertexModule,entryPoint:"main",buffers:[c,t]},l={format:"bgra8unorm",blend:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},writeMask:GPUColorWrite.ALL},a={module:this.fragmentModule,entryPoint:"main",targets:[l]},u={layout:p,vertex:M,fragment:a,primitive:{topology:"triangle-list",frontFace:"cw",cullMode:"none"},depthStencil:i,multisample:{count:this.sampleCount}};this.renderPipeline=this.device.createRenderPipeline(u)}async start(){if(await this.initialize())this.resizeSwapchain(),await this.initializeResources(),this.render();else{const n=document.getElementById("error");n.style.display="block"}}}const ro=document.getElementById("webgpu_canvas"),co=new oo(ro);co.start();
