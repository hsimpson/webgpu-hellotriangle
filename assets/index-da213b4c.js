(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}})();let q=1e-6;const Se=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);Se.get(Float32Array);let A=Float32Array;function ve(n){const e=A;return A=n,e}function I(n,e,o){const r=new A(3);return n!==void 0&&(r[0]=n,e!==void 0&&(r[1]=e,o!==void 0&&(r[2]=o))),r}const ze=I;function Te(n,e){return e=e||new A(3),e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e}function Be(n,e){return e=e||new A(3),e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e}function Pe(n,e){return e=e||new A(3),e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e}function qe(n,e=0,o=1,r){return r=r||new A(3),r[0]=Math.min(o,Math.max(e,n[0])),r[1]=Math.min(o,Math.max(e,n[1])),r[2]=Math.min(o,Math.max(e,n[2])),r}function Ee(n,e,o){return o=o||new A(3),o[0]=n[0]+e[0],o[1]=n[1]+e[1],o[2]=n[2]+e[2],o}function me(n,e,o,r){return r=r||new A(3),r[0]=n[0]+e[0]*o,r[1]=n[1]+e[1]*o,r[2]=n[2]+e[2]*o,r}function Ce(n,e){const o=n[0],r=n[1],t=n[2],i=n[0],c=n[1],f=n[2],l=Math.sqrt(o*o+r*r+t*t),p=Math.sqrt(i*i+c*c+f*f),h=l*p,a=h&&ue(n,e)/h;return Math.acos(a)}function b(n,e,o){return o=o||new A(3),o[0]=n[0]-e[0],o[1]=n[1]-e[1],o[2]=n[2]-e[2],o}const Oe=b;function Ue(n,e){return Math.abs(n[0]-e[0])<q&&Math.abs(n[1]-e[1])<q&&Math.abs(n[2]-e[2])<q}function Ve(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}function Fe(n,e,o,r){return r=r||new A(3),r[0]=n[0]+o*(e[0]-n[0]),r[1]=n[1]+o*(e[1]-n[1]),r[2]=n[2]+o*(e[2]-n[2]),r}function Le(n,e,o,r){return r=r||new A(3),r[0]=n[0]+o[0]*(e[0]-n[0]),r[1]=n[1]+o[1]*(e[1]-n[1]),r[2]=n[2]+o[2]*(e[2]-n[2]),r}function Ge(n,e,o){return o=o||new A(3),o[0]=Math.max(n[0],e[0]),o[1]=Math.max(n[1],e[1]),o[2]=Math.max(n[2],e[2]),o}function Re(n,e,o){return o=o||new A(3),o[0]=Math.min(n[0],e[0]),o[1]=Math.min(n[1],e[1]),o[2]=Math.min(n[2],e[2]),o}function ie(n,e,o){return o=o||new A(3),o[0]=n[0]*e,o[1]=n[1]*e,o[2]=n[2]*e,o}const Ne=ie;function De(n,e,o){return o=o||new A(3),o[0]=n[0]/e,o[1]=n[1]/e,o[2]=n[2]/e,o}function ae(n,e){return e=e||new A(3),e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e}const Ie=ae;function Y(n,e,o){o=o||new A(3);const r=n[2]*e[0]-n[0]*e[2],t=n[0]*e[1]-n[1]*e[0];return o[0]=n[1]*e[2]-n[2]*e[1],o[1]=r,o[2]=t,o}function ue(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function he(n){const e=n[0],o=n[1],r=n[2];return Math.sqrt(e*e+o*o+r*r)}const _e=he;function fe(n){const e=n[0],o=n[1],r=n[2];return e*e+o*o+r*r}const Xe=fe;function le(n,e){const o=n[0]-e[0],r=n[1]-e[1],t=n[2]-e[2];return Math.sqrt(o*o+r*r+t*t)}const We=le;function pe(n,e){const o=n[0]-e[0],r=n[1]-e[1],t=n[2]-e[2];return o*o+r*r+t*t}const Ye=pe;function W(n,e){e=e||new A(3);const o=n[0],r=n[1],t=n[2],i=Math.sqrt(o*o+r*r+t*t);return i>1e-5?(e[0]=o/i,e[1]=r/i,e[2]=t/i):(e[0]=0,e[1]=0,e[2]=0),e}function Ze(n,e){return e=e||new A(3),e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e}function se(n,e){return e=e||new A(3),e[0]=n[0],e[1]=n[1],e[2]=n[2],e}const be=se;function Me(n,e,o){return o=o||new A(3),o[0]=n[0]*e[0],o[1]=n[1]*e[1],o[2]=n[2]*e[2],o}const je=Me;function we(n,e,o){return o=o||new A(3),o[0]=n[0]/e[0],o[1]=n[1]/e[1],o[2]=n[2]/e[2],o}const He=we;function Ke(n=1,e){e=e||new A(3);const o=Math.random()*2*Math.PI,r=Math.random()*2-1,t=Math.sqrt(1-r*r)*n;return e[0]=Math.cos(o)*t,e[1]=Math.sin(o)*t,e[2]=r*n,e}function Je(n){return n=n||new A(3),n[0]=0,n[1]=0,n[2]=0,n}function Qe(n,e,o){o=o||new A(3);const r=n[0],t=n[1],i=n[2],c=e[3]*r+e[7]*t+e[11]*i+e[15]||1;return o[0]=(e[0]*r+e[4]*t+e[8]*i+e[12])/c,o[1]=(e[1]*r+e[5]*t+e[9]*i+e[13])/c,o[2]=(e[2]*r+e[6]*t+e[10]*i+e[14])/c,o}function ke(n,e,o){o=o||new A(3);const r=n[0],t=n[1],i=n[2];return o[0]=r*e[0*4+0]+t*e[1*4+0]+i*e[2*4+0],o[1]=r*e[0*4+1]+t*e[1*4+1]+i*e[2*4+1],o[2]=r*e[0*4+2]+t*e[1*4+2]+i*e[2*4+2],o}function de(n,e,o){o=o||new A(3);const r=n[0],t=n[1],i=n[2];return o[0]=r*e[0]+t*e[4]+i*e[8],o[1]=r*e[1]+t*e[5]+i*e[9],o[2]=r*e[2]+t*e[6]+i*e[10],o}var ee=Object.freeze({__proto__:null,create:I,setDefaultType:ve,fromValues:ze,ceil:Te,floor:Be,round:Pe,clamp:qe,add:Ee,addScaled:me,angle:Ce,subtract:b,sub:Oe,equalsApproximately:Ue,equals:Ve,lerp:Fe,lerpV:Le,max:Ge,min:Re,mulScalar:ie,scale:Ne,divScalar:De,inverse:ae,invert:Ie,cross:Y,dot:ue,length:he,len:_e,lengthSq:fe,lenSq:Xe,distance:le,dist:We,distanceSq:pe,distSq:Ye,normalize:W,negate:Ze,copy:se,clone:be,multiply:Me,mul:je,divide:we,div:He,random:Ke,zero:Je,transformMat4:Qe,transformMat4Upper3x3:ke,transformMat3:de});let $=Float32Array;function en(n){const e=$;return $=n,e}function nn(n,e,o,r,t,i,c,f,l,p,h,a,u,w,M,g){const s=new $(16);return n!==void 0&&(s[0]=n,e!==void 0&&(s[1]=e,o!==void 0&&(s[2]=o,r!==void 0&&(s[3]=r,t!==void 0&&(s[4]=t,i!==void 0&&(s[5]=i,c!==void 0&&(s[6]=c,f!==void 0&&(s[7]=f,l!==void 0&&(s[8]=l,p!==void 0&&(s[9]=p,h!==void 0&&(s[10]=h,a!==void 0&&(s[11]=a,u!==void 0&&(s[12]=u,w!==void 0&&(s[13]=w,M!==void 0&&(s[14]=M,g!==void 0&&(s[15]=g)))))))))))))))),s}function on(n,e){return e=e||new $(16),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=0,e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=0,e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rn(n,e){return e=e||new $(16),e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e[4]=-n[4],e[5]=-n[5],e[6]=-n[6],e[7]=-n[7],e[8]=-n[8],e[9]=-n[9],e[10]=-n[10],e[11]=-n[11],e[12]=-n[12],e[13]=-n[13],e[14]=-n[14],e[15]=-n[15],e}function ne(n,e){return e=e||new $(16),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}const tn=ne;function cn(n,e){return Math.abs(n[0]-e[0])<q&&Math.abs(n[1]-e[1])<q&&Math.abs(n[2]-e[2])<q&&Math.abs(n[3]-e[3])<q&&Math.abs(n[4]-e[4])<q&&Math.abs(n[5]-e[5])<q&&Math.abs(n[6]-e[6])<q&&Math.abs(n[7]-e[7])<q&&Math.abs(n[8]-e[8])<q&&Math.abs(n[9]-e[9])<q&&Math.abs(n[10]-e[10])<q&&Math.abs(n[11]-e[11])<q&&Math.abs(n[12]-e[12])<q&&Math.abs(n[13]-e[13])<q&&Math.abs(n[14]-e[14])<q&&Math.abs(n[15]-e[15])<q}function an(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]}function ye(n){return n=n||new $(16),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function un(n,e){if(e=e||new $(16),e===n){let y;return y=n[1],n[1]=n[4],n[4]=y,y=n[2],n[2]=n[8],n[8]=y,y=n[3],n[3]=n[12],n[12]=y,y=n[6],n[6]=n[9],n[9]=y,y=n[7],n[7]=n[13],n[13]=y,y=n[11],n[11]=n[14],n[14]=y,e}const o=n[0*4+0],r=n[0*4+1],t=n[0*4+2],i=n[0*4+3],c=n[1*4+0],f=n[1*4+1],l=n[1*4+2],p=n[1*4+3],h=n[2*4+0],a=n[2*4+1],u=n[2*4+2],w=n[2*4+3],M=n[3*4+0],g=n[3*4+1],s=n[3*4+2],S=n[3*4+3];return e[0]=o,e[1]=c,e[2]=h,e[3]=M,e[4]=r,e[5]=f,e[6]=a,e[7]=g,e[8]=t,e[9]=l,e[10]=u,e[11]=s,e[12]=i,e[13]=p,e[14]=w,e[15]=S,e}function ge(n,e){e=e||new $(16);const o=n[0*4+0],r=n[0*4+1],t=n[0*4+2],i=n[0*4+3],c=n[1*4+0],f=n[1*4+1],l=n[1*4+2],p=n[1*4+3],h=n[2*4+0],a=n[2*4+1],u=n[2*4+2],w=n[2*4+3],M=n[3*4+0],g=n[3*4+1],s=n[3*4+2],S=n[3*4+3],y=u*S,T=s*w,B=l*S,P=s*p,E=l*w,m=u*p,C=t*S,O=s*i,U=t*w,V=u*i,F=t*p,G=l*i,R=h*g,N=M*a,D=c*g,_=M*f,X=c*a,j=h*f,H=o*g,K=M*r,J=o*a,Q=h*r,k=o*f,d=c*r,oe=y*f+P*a+E*g-(T*f+B*a+m*g),re=T*r+C*a+V*g-(y*r+O*a+U*g),te=B*r+O*f+F*g-(P*r+C*f+G*g),ce=m*r+U*f+G*a-(E*r+V*f+F*a),L=1/(o*oe+c*re+h*te+M*ce);return e[0]=L*oe,e[1]=L*re,e[2]=L*te,e[3]=L*ce,e[4]=L*(T*c+B*h+m*M-(y*c+P*h+E*M)),e[5]=L*(y*o+O*h+U*M-(T*o+C*h+V*M)),e[6]=L*(P*o+C*c+G*M-(B*o+O*c+F*M)),e[7]=L*(E*o+V*c+F*h-(m*o+U*c+G*h)),e[8]=L*(R*p+_*w+X*S-(N*p+D*w+j*S)),e[9]=L*(N*i+H*w+Q*S-(R*i+K*w+J*S)),e[10]=L*(D*i+K*p+k*S-(_*i+H*p+d*S)),e[11]=L*(j*i+J*p+d*w-(X*i+Q*p+k*w)),e[12]=L*(D*u+j*s+N*l-(X*s+R*l+_*u)),e[13]=L*(J*s+R*t+K*u-(H*u+Q*s+N*t)),e[14]=L*(H*l+d*s+_*t-(k*s+D*t+K*l)),e[15]=L*(k*u+X*t+Q*l-(J*l+d*u+j*t)),e}function hn(n){const e=n[0],o=n[0*4+1],r=n[0*4+2],t=n[0*4+3],i=n[1*4+0],c=n[1*4+1],f=n[1*4+2],l=n[1*4+3],p=n[2*4+0],h=n[2*4+1],a=n[2*4+2],u=n[2*4+3],w=n[3*4+0],M=n[3*4+1],g=n[3*4+2],s=n[3*4+3],S=a*s,y=g*u,T=f*s,B=g*l,P=f*u,E=a*l,m=r*s,C=g*t,O=r*u,U=a*t,V=r*l,F=f*t,G=S*c+B*h+P*M-(y*c+T*h+E*M),R=y*o+m*h+U*M-(S*o+C*h+O*M),N=T*o+C*c+V*M-(B*o+m*c+F*M),D=E*o+O*c+F*h-(P*o+U*c+V*h);return e*G+i*R+p*N+w*D}const fn=ge;function xe(n,e,o){o=o||new $(16);const r=n[0],t=n[1],i=n[2],c=n[3],f=n[4+0],l=n[4+1],p=n[4+2],h=n[4+3],a=n[8+0],u=n[8+1],w=n[8+2],M=n[8+3],g=n[12+0],s=n[12+1],S=n[12+2],y=n[12+3],T=e[0],B=e[1],P=e[2],E=e[3],m=e[4+0],C=e[4+1],O=e[4+2],U=e[4+3],V=e[8+0],F=e[8+1],G=e[8+2],R=e[8+3],N=e[12+0],D=e[12+1],_=e[12+2],X=e[12+3];return o[0]=r*T+f*B+a*P+g*E,o[1]=t*T+l*B+u*P+s*E,o[2]=i*T+p*B+w*P+S*E,o[3]=c*T+h*B+M*P+y*E,o[4]=r*m+f*C+a*O+g*U,o[5]=t*m+l*C+u*O+s*U,o[6]=i*m+p*C+w*O+S*U,o[7]=c*m+h*C+M*O+y*U,o[8]=r*V+f*F+a*G+g*R,o[9]=t*V+l*F+u*G+s*R,o[10]=i*V+p*F+w*G+S*R,o[11]=c*V+h*F+M*G+y*R,o[12]=r*N+f*D+a*_+g*X,o[13]=t*N+l*D+u*_+s*X,o[14]=i*N+p*D+w*_+S*X,o[15]=c*N+h*D+M*_+y*X,o}const ln=xe;function pn(n,e,o){return o=o||ye(),n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11]),o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}function sn(n,e){return e=e||I(),e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function Mn(n,e,o){o=o||I();const r=e*4;return o[0]=n[r+0],o[1]=n[r+1],o[2]=n[r+2],o}function wn(n,e,o,r){r!==n&&(r=ne(n,r));const t=o*4;return r[t+0]=e[0],r[t+1]=e[1],r[t+2]=e[2],r}function yn(n,e){e=e||I();const o=n[0],r=n[1],t=n[2],i=n[4],c=n[5],f=n[6],l=n[8],p=n[9],h=n[10];return e[0]=Math.sqrt(o*o+r*r+t*t),e[1]=Math.sqrt(i*i+c*c+f*f),e[2]=Math.sqrt(l*l+p*p+h*h),e}function gn(n,e,o,r,t){t=t||new $(16);const i=Math.tan(Math.PI*.5-.5*n);if(t[0]=i/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r===1/0)t[10]=-1,t[14]=-o;else{const c=1/(o-r);t[10]=r*c,t[14]=r*o*c}return t}function xn(n,e,o,r,t,i,c){return c=c||new $(16),c[0]=2/(e-n),c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/(r-o),c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1/(t-i),c[11]=0,c[12]=(e+n)/(n-e),c[13]=(r+o)/(o-r),c[14]=t/(t-i),c[15]=1,c}function An(n,e,o,r,t,i,c){c=c||new $(16);const f=e-n,l=r-o,p=t-i;return c[0]=2*t/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*t/l,c[6]=0,c[7]=0,c[8]=(n+e)/f,c[9]=(r+o)/l,c[10]=i/p,c[11]=-1,c[12]=0,c[13]=0,c[14]=t*i/p,c[15]=0,c}let v,z,x;function $n(n,e,o,r){return r=r||new $(16),v=v||I(),z=z||I(),x=x||I(),W(b(e,n,x),x),W(Y(o,x,v),v),W(Y(x,v,z),z),r[0]=v[0],r[1]=v[1],r[2]=v[2],r[3]=0,r[4]=z[0],r[5]=z[1],r[6]=z[2],r[7]=0,r[8]=x[0],r[9]=x[1],r[10]=x[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function Sn(n,e,o,r){return r=r||new $(16),v=v||I(),z=z||I(),x=x||I(),W(b(n,e,x),x),W(Y(o,x,v),v),W(Y(x,v,z),z),r[0]=v[0],r[1]=v[1],r[2]=v[2],r[3]=0,r[4]=z[0],r[5]=z[1],r[6]=z[2],r[7]=0,r[8]=x[0],r[9]=x[1],r[10]=x[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function vn(n,e,o,r){return r=r||new $(16),v=v||I(),z=z||I(),x=x||I(),W(b(n,e,x),x),W(Y(o,x,v),v),W(Y(x,v,z),z),r[0]=v[0],r[1]=z[0],r[2]=x[0],r[3]=0,r[4]=v[1],r[5]=z[1],r[6]=x[1],r[7]=0,r[8]=v[2],r[9]=z[2],r[10]=x[2],r[11]=0,r[12]=-(v[0]*n[0]+v[1]*n[1]+v[2]*n[2]),r[13]=-(z[0]*n[0]+z[1]*n[1]+z[2]*n[2]),r[14]=-(x[0]*n[0]+x[1]*n[1]+x[2]*n[2]),r[15]=1,r}function zn(n,e){return e=e||new $(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Tn(n,e,o){o=o||new $(16);const r=e[0],t=e[1],i=e[2],c=n[0],f=n[1],l=n[2],p=n[3],h=n[1*4+0],a=n[1*4+1],u=n[1*4+2],w=n[1*4+3],M=n[2*4+0],g=n[2*4+1],s=n[2*4+2],S=n[2*4+3],y=n[3*4+0],T=n[3*4+1],B=n[3*4+2],P=n[3*4+3];return n!==o&&(o[0]=c,o[1]=f,o[2]=l,o[3]=p,o[4]=h,o[5]=a,o[6]=u,o[7]=w,o[8]=M,o[9]=g,o[10]=s,o[11]=S),o[12]=c*r+h*t+M*i+y,o[13]=f*r+a*t+g*i+T,o[14]=l*r+u*t+s*i+B,o[15]=p*r+w*t+S*i+P,o}function Bn(n,e){e=e||new $(16);const o=Math.cos(n),r=Math.sin(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pn(n,e,o){o=o||new $(16);const r=n[4],t=n[5],i=n[6],c=n[7],f=n[8],l=n[9],p=n[10],h=n[11],a=Math.cos(e),u=Math.sin(e);return o[4]=a*r+u*f,o[5]=a*t+u*l,o[6]=a*i+u*p,o[7]=a*c+u*h,o[8]=a*f-u*r,o[9]=a*l-u*t,o[10]=a*p-u*i,o[11]=a*h-u*c,n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function qn(n,e){e=e||new $(16);const o=Math.cos(n),r=Math.sin(n);return e[0]=o,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function En(n,e,o){o=o||new $(16);const r=n[0*4+0],t=n[0*4+1],i=n[0*4+2],c=n[0*4+3],f=n[2*4+0],l=n[2*4+1],p=n[2*4+2],h=n[2*4+3],a=Math.cos(e),u=Math.sin(e);return o[0]=a*r-u*f,o[1]=a*t-u*l,o[2]=a*i-u*p,o[3]=a*c-u*h,o[8]=a*f+u*r,o[9]=a*l+u*t,o[10]=a*p+u*i,o[11]=a*h+u*c,n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function mn(n,e){e=e||new $(16);const o=Math.cos(n),r=Math.sin(n);return e[0]=o,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cn(n,e,o){o=o||new $(16);const r=n[0*4+0],t=n[0*4+1],i=n[0*4+2],c=n[0*4+3],f=n[1*4+0],l=n[1*4+1],p=n[1*4+2],h=n[1*4+3],a=Math.cos(e),u=Math.sin(e);return o[0]=a*r+u*f,o[1]=a*t+u*l,o[2]=a*i+u*p,o[3]=a*c+u*h,o[4]=a*f-u*r,o[5]=a*l-u*t,o[6]=a*p-u*i,o[7]=a*h-u*c,n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}function Ae(n,e,o){o=o||new $(16);let r=n[0],t=n[1],i=n[2];const c=Math.sqrt(r*r+t*t+i*i);r/=c,t/=c,i/=c;const f=r*r,l=t*t,p=i*i,h=Math.cos(e),a=Math.sin(e),u=1-h;return o[0]=f+(1-f)*h,o[1]=r*t*u+i*a,o[2]=r*i*u-t*a,o[3]=0,o[4]=r*t*u-i*a,o[5]=l+(1-l)*h,o[6]=t*i*u+r*a,o[7]=0,o[8]=r*i*u+t*a,o[9]=t*i*u-r*a,o[10]=p+(1-p)*h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}const On=Ae;function $e(n,e,o,r){r=r||new $(16);let t=e[0],i=e[1],c=e[2];const f=Math.sqrt(t*t+i*i+c*c);t/=f,i/=f,c/=f;const l=t*t,p=i*i,h=c*c,a=Math.cos(o),u=Math.sin(o),w=1-a,M=l+(1-l)*a,g=t*i*w+c*u,s=t*c*w-i*u,S=t*i*w-c*u,y=p+(1-p)*a,T=i*c*w+t*u,B=t*c*w+i*u,P=i*c*w-t*u,E=h+(1-h)*a,m=n[0],C=n[1],O=n[2],U=n[3],V=n[4],F=n[5],G=n[6],R=n[7],N=n[8],D=n[9],_=n[10],X=n[11];return r[0]=M*m+g*V+s*N,r[1]=M*C+g*F+s*D,r[2]=M*O+g*G+s*_,r[3]=M*U+g*R+s*X,r[4]=S*m+y*V+T*N,r[5]=S*C+y*F+T*D,r[6]=S*O+y*G+T*_,r[7]=S*U+y*R+T*X,r[8]=B*m+P*V+E*N,r[9]=B*C+P*F+E*D,r[10]=B*O+P*G+E*_,r[11]=B*U+P*R+E*X,n!==r&&(r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r}const Un=$e;function Vn(n,e){return e=e||new $(16),e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fn(n,e,o){o=o||new $(16);const r=e[0],t=e[1],i=e[2];return o[0]=r*n[0*4+0],o[1]=r*n[0*4+1],o[2]=r*n[0*4+2],o[3]=r*n[0*4+3],o[4]=t*n[1*4+0],o[5]=t*n[1*4+1],o[6]=t*n[1*4+2],o[7]=t*n[1*4+3],o[8]=i*n[2*4+0],o[9]=i*n[2*4+1],o[10]=i*n[2*4+2],o[11]=i*n[2*4+3],n!==o&&(o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o}var Z=Object.freeze({__proto__:null,setDefaultType:en,create:nn,fromMat3:on,negate:rn,copy:ne,clone:tn,equalsApproximately:cn,equals:an,identity:ye,transpose:un,inverse:ge,determinant:hn,invert:fn,multiply:xe,mul:ln,setTranslation:pn,getTranslation:sn,getAxis:Mn,setAxis:wn,getScaling:yn,perspective:gn,ortho:xn,frustum:An,aim:$n,cameraAim:Sn,lookAt:vn,translation:zn,translate:Tn,rotationX:Bn,rotateX:Pn,rotationY:qn,rotateY:En,rotationZ:mn,rotateZ:Cn,axisRotation:Ae,rotation:On,axisRotate:$e,rotate:Un,scaling:Vn,scale:Fn});const Ln=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),Gn=new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1]),Rn=new Uint16Array([0,1,2,0]);class Nn{constructor(e){this.modelMatrix=Z.identity(),this.viewMatrix=Z.identity(),this.perspectiveMatrix=Z.identity(),this.eye=ee.create(0,0,5),this.zNear=.1,this.zFar=1e3,this.sampleCount=4,this.onMouseWheel=o=>{let r=this.eye[2]+=o.deltaY*.01;r=Math.max(this.zNear,Math.min(this.zFar,r)),this.eye[2]=r},this.render=()=>{const o=.5*Math.PI/180;Z.rotateZ(this.modelMatrix,o,this.modelMatrix),this.updateUniformBuffer(),this.encodeCommands(),requestAnimationFrame(this.render)},this.canvas=e,this.updateViewMatrix(),this.updatePerspectiveMatrix()}updatePerspectiveMatrix(){const e=this.canvas.width/this.canvas.height,o=45*Math.PI/180;this.perspectiveMatrix=Z.perspective(o,e,this.zNear,this.zFar)}updateViewMatrix(){const e=ee.create(0,0,0),o=ee.create(0,1,0);this.viewMatrix=Z.lookAt(this.eye,e,o)}resize(e,o){(e!==this.presentationSize.width||o!==this.presentationSize.height)&&(this.canvas.width=e,this.canvas.height=o,this.presentationSize={width:e,height:o,depthOrArrayLayers:1},this.updatePerspectiveMatrix(),this.resizeSwapchain())}async initialize(){const e=navigator.gpu;if(!e)return console.error("No WebGPU support navigator.gpu not available!"),!1;const o=await e.requestAdapter();return console.log(o.limits),this.device=await o.requestDevice(),this.queue=this.device.queue,this.canvas.style.display="block",this.canvas.addEventListener("wheel",this.onMouseWheel),this.presentationSize={width:this.canvas.width,height:this.canvas.height,depthOrArrayLayers:1},this.presentationContext=this.canvas.getContext("webgpu"),this.presentationFormat=e.getPreferredCanvasFormat(),this.presentationContext.configure({device:this.device,format:this.presentationFormat,alphaMode:"opaque"}),new ResizeObserver(t=>{Array.isArray(t)&&this.resize(t[0].contentRect.width*window.devicePixelRatio,t[0].contentRect.height*window.devicePixelRatio)}).observe(this.canvas),!0}createBuffer(e,o){try{const r=this.device.createBuffer({mappedAtCreation:!0,size:e.byteLength,usage:o}),t=r.getMappedRange();return(e instanceof Float32Array?new Float32Array(t):new Uint16Array(t)).set(e),r.unmap(),r}catch(r){console.error(r)}}createUBOArray(){const e=new Float32Array(48);return e.set(this.modelMatrix),e.set(this.viewMatrix,16),e.set(this.perspectiveMatrix,32),e}updateUniformBuffer(){this.updateViewMatrix();const e=this.createUBOArray();this.queue.writeBuffer(this.uniformBuffer,0,e.buffer)}async loadShader(e){const o=await fetch(e);return this.device.createShaderModule({code:await o.text()})}resizeSwapchain(){this.renderTarget!==void 0&&(this.renderTarget.destroy(),this.depthTarget.destroy()),this.renderTarget=this.device.createTexture({size:this.presentationSize,sampleCount:this.sampleCount,format:this.presentationFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.renderTargetView=this.renderTarget.createView(),this.depthTarget=this.device.createTexture({size:this.presentationSize,sampleCount:this.sampleCount,format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTargetView=this.depthTarget.createView()}encodeCommands(){const e={view:this.presentationContext.getCurrentTexture().createView(),clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"};this.sampleCount>1&&(e.view=this.renderTargetView,e.resolveTarget=this.presentationContext.getCurrentTexture().createView());const o={view:this.depthTargetView,depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store",stencilLoadOp:"clear",stencilClearValue:0,stencilStoreOp:"store"},r={colorAttachments:[e],depthStencilAttachment:o};this.commandEncoder=this.device.createCommandEncoder(),this.passEncoder=this.commandEncoder.beginRenderPass(r),this.passEncoder.setPipeline(this.renderPipeline),this.passEncoder.setBindGroup(0,this.uniformBindGroup),this.passEncoder.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),this.passEncoder.setScissorRect(0,0,this.canvas.width,this.canvas.height),this.passEncoder.setVertexBuffer(0,this.positionBuffer),this.passEncoder.setVertexBuffer(1,this.colorBuffer),this.passEncoder.setIndexBuffer(this.indexBuffer,"uint16"),this.passEncoder.drawIndexed(3,1,0,0,0),this.passEncoder.end(),this.queue.submit([this.commandEncoder.finish()])}async initializeResources(){this.positionBuffer=this.createBuffer(Ln,GPUBufferUsage.VERTEX),this.colorBuffer=this.createBuffer(Gn,GPUBufferUsage.VERTEX),this.indexBuffer=this.createBuffer(Rn,GPUBufferUsage.INDEX);const e=this.createUBOArray();this.uniformBuffer=this.createBuffer(e,GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST),this.vertexModule=await this.loadShader("./shaders/basic.vert.wgsl"),this.fragmentModule=await this.loadShader("./shaders/basic.frag.wgsl");const o={shaderLocation:0,offset:0,format:"float32x3"},r={shaderLocation:1,offset:0,format:"float32x4"},t={attributes:[o],arrayStride:4*3,stepMode:"vertex"},i={attributes:[r],arrayStride:4*4,stepMode:"vertex"},c={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"},f=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]});this.uniformBindGroup=this.device.createBindGroup({layout:f,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const l={bindGroupLayouts:[f]},p=this.device.createPipelineLayout(l),h={module:this.vertexModule,entryPoint:"main",buffers:[t,i]},a={format:"bgra8unorm",blend:{alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},writeMask:GPUColorWrite.ALL},u={module:this.fragmentModule,entryPoint:"main",targets:[a]},w={layout:p,vertex:h,fragment:u,primitive:{topology:"triangle-list",frontFace:"cw",cullMode:"none"},depthStencil:c,multisample:{count:this.sampleCount}};this.renderPipeline=this.device.createRenderPipeline(w)}async start(){if(await this.initialize())this.resizeSwapchain(),await this.initializeResources(),this.render();else{const e=document.getElementById("error");e.style.display="block"}}}const Dn=document.getElementById("webgpu_canvas"),In=new Nn(Dn);In.start();
